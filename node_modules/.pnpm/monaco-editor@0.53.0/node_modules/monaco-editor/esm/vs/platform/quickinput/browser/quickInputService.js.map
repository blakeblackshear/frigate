{"version":3,"sources":["file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src/vs/platform/quickinput/browser/quickInputService.ts","vs/platform/quickinput/browser/quickInputService.ts"],"names":[],"mappings":"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","file":"quickInputService.js","sourceRoot":"file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { IContextKey, IContextKeyService, RawContextKey } from '../../contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../instantiation/common/instantiation.js';\nimport { ILayoutService } from '../../layout/browser/layoutService.js';\nimport { IOpenerService } from '../../opener/common/opener.js';\nimport { QuickAccessController } from './quickAccess.js';\nimport { IQuickAccessController } from '../common/quickAccess.js';\nimport { IInputBox, IInputOptions, IPickOptions, IQuickInputService, IQuickPick, IQuickPickItem, QuickPickInput } from '../common/quickInput.js';\nimport { defaultButtonStyles, defaultCountBadgeStyles, defaultInputBoxStyles, defaultKeybindingLabelStyles, defaultProgressBarStyles, defaultToggleStyles, getListStyles } from '../../theme/browser/defaultStyles.js';\nimport { activeContrastBorder, asCssVariable, pickerGroupBorder, pickerGroupForeground, quickInputBackground, quickInputForeground, quickInputListFocusBackground, quickInputListFocusForeground, quickInputListFocusIconForeground, quickInputTitleBackground, widgetBorder, widgetShadow } from '../../theme/common/colorRegistry.js';\nimport { IThemeService, Themable } from '../../theme/common/themeService.js';\nimport { IQuickInputOptions, IQuickInputStyles, QuickInputHoverDelegate } from './quickInput.js';\nimport { QuickInputController, IQuickInputControllerHost } from './quickInputController.js';\nimport { IConfigurationService } from '../../configuration/common/configuration.js';\nimport { getWindow } from '../../../base/browser/dom.js';\n\nexport class QuickInputService extends Themable implements IQuickInputService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onShow = this._register(new Emitter<void>());\n\n\tprivate readonly _onHide = this._register(new Emitter<void>());\n\n\tprivate _controller: QuickInputController | undefined;\n\tprivate get controller(): QuickInputController {\n\t\tif (!this._controller) {\n\t\t\tthis._controller = this._register(this.createController());\n\t\t}\n\n\t\treturn this._controller;\n\t}\n\n\tprivate get hasController() { return !!this._controller; }\n\tget currentQuickInput() { return this.controller.currentQuickInput; }\n\n\tprivate _quickAccess: IQuickAccessController | undefined;\n\tget quickAccess(): IQuickAccessController {\n\t\tif (!this._quickAccess) {\n\t\t\tthis._quickAccess = this._register(this.instantiationService.createInstance(QuickAccessController));\n\t\t}\n\n\t\treturn this._quickAccess;\n\t}\n\n\tprivate readonly contexts = new Map<string, IContextKey<boolean>>();\n\n\tconstructor(\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IContextKeyService protected readonly contextKeyService: IContextKeyService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@ILayoutService protected readonly layoutService: ILayoutService,\n\t\t@IConfigurationService protected readonly configurationService: IConfigurationService,\n\t) {\n\t\tsuper(themeService);\n\t}\n\n\tprotected createController(host: IQuickInputControllerHost = this.layoutService, options?: Partial<IQuickInputOptions>): QuickInputController {\n\t\tconst defaultOptions: IQuickInputOptions = {\n\t\t\tidPrefix: 'quickInput_',\n\t\t\tcontainer: host.activeContainer,\n\t\t\tignoreFocusOut: () => false,\n\t\t\tbackKeybindingLabel: () => undefined,\n\t\t\tsetContextKey: (id?: string) => this.setContextKey(id),\n\t\t\tlinkOpenerDelegate: (content) => {\n\t\t\t\t// HACK: https://github.com/microsoft/vscode/issues/173691\n\t\t\t\tthis.instantiationService.invokeFunction(accessor => {\n\t\t\t\t\tconst openerService = accessor.get(IOpenerService);\n\t\t\t\t\topenerService.open(content, { allowCommands: true, fromUserGesture: true });\n\t\t\t\t});\n\t\t\t},\n\t\t\treturnFocus: () => host.focus(),\n\t\t\tstyles: this.computeStyles(),\n\t\t\thoverDelegate: this._register(this.instantiationService.createInstance(QuickInputHoverDelegate))\n\t\t};\n\n\t\tconst controller = this._register(this.instantiationService.createInstance(\n\t\t\tQuickInputController,\n\t\t\t{\n\t\t\t\t...defaultOptions,\n\t\t\t\t...options\n\t\t\t}\n\t\t));\n\n\t\tcontroller.layout(host.activeContainerDimension, host.activeContainerOffset.quickPickTop);\n\n\t\t// Layout changes\n\t\tthis._register(host.onDidLayoutActiveContainer(dimension => {\n\t\t\tif (getWindow(host.activeContainer) === getWindow(controller.container)) {\n\t\t\t\tcontroller.layout(dimension, host.activeContainerOffset.quickPickTop);\n\t\t\t}\n\t\t}));\n\t\tthis._register(host.onDidChangeActiveContainer(() => {\n\t\t\tif (controller.isVisible()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcontroller.layout(host.activeContainerDimension, host.activeContainerOffset.quickPickTop);\n\t\t}));\n\n\t\t// Context keys\n\t\tthis._register(controller.onShow(() => {\n\t\t\tthis.resetContextKeys();\n\t\t\tthis._onShow.fire();\n\t\t}));\n\t\tthis._register(controller.onHide(() => {\n\t\t\tthis.resetContextKeys();\n\t\t\tthis._onHide.fire();\n\t\t}));\n\n\t\treturn controller;\n\t}\n\n\tprivate setContextKey(id?: string) {\n\t\tlet key: IContextKey<boolean> | undefined;\n\t\tif (id) {\n\t\t\tkey = this.contexts.get(id);\n\t\t\tif (!key) {\n\t\t\t\tkey = new RawContextKey<boolean>(id, false)\n\t\t\t\t\t.bindTo(this.contextKeyService);\n\t\t\t\tthis.contexts.set(id, key);\n\t\t\t}\n\t\t}\n\n\t\tif (key && key.get()) {\n\t\t\treturn; // already active context\n\t\t}\n\n\t\tthis.resetContextKeys();\n\n\t\tkey?.set(true);\n\t}\n\n\tprivate resetContextKeys() {\n\t\tthis.contexts.forEach(context => {\n\t\t\tif (context.get()) {\n\t\t\t\tcontext.reset();\n\t\t\t}\n\t\t});\n\t}\n\n\tpick<T extends IQuickPickItem, O extends IPickOptions<T>>(picks: Promise<QuickPickInput<T>[]> | QuickPickInput<T>[], options?: O, token: CancellationToken = CancellationToken.None): Promise<(O extends { canPickMany: true } ? T[] : T) | undefined> {\n\t\treturn this.controller.pick(picks, options, token);\n\t}\n\n\tinput(options: IInputOptions = {}, token: CancellationToken = CancellationToken.None): Promise<string | undefined> {\n\t\treturn this.controller.input(options, token);\n\t}\n\n\tcreateQuickPick<T extends IQuickPickItem>(options: { useSeparators: true }): IQuickPick<T, { useSeparators: true }>;\n\tcreateQuickPick<T extends IQuickPickItem>(options?: { useSeparators: boolean }): IQuickPick<T, { useSeparators: false }>;\n\tcreateQuickPick<T extends IQuickPickItem>(options: { useSeparators: boolean } = { useSeparators: false }): IQuickPick<T, { useSeparators: boolean }> {\n\t\treturn this.controller.createQuickPick(options);\n\t}\n\n\tcreateInputBox(): IInputBox {\n\t\treturn this.controller.createInputBox();\n\t}\n\n\ttoggleHover(): void {\n\t\tif (this.hasController) {\n\t\t\tthis.controller.toggleHover();\n\t\t}\n\t}\n\n\toverride updateStyles() {\n\t\tif (this.hasController) {\n\t\t\tthis.controller.applyStyles(this.computeStyles());\n\t\t}\n\t}\n\n\tprivate computeStyles(): IQuickInputStyles {\n\t\treturn {\n\t\t\twidget: {\n\t\t\t\tquickInputBackground: asCssVariable(quickInputBackground),\n\t\t\t\tquickInputForeground: asCssVariable(quickInputForeground),\n\t\t\t\tquickInputTitleBackground: asCssVariable(quickInputTitleBackground),\n\t\t\t\twidgetBorder: asCssVariable(widgetBorder),\n\t\t\t\twidgetShadow: asCssVariable(widgetShadow),\n\t\t\t},\n\t\t\tinputBox: defaultInputBoxStyles,\n\t\t\ttoggle: defaultToggleStyles,\n\t\t\tcountBadge: defaultCountBadgeStyles,\n\t\t\tbutton: defaultButtonStyles,\n\t\t\tprogressBar: defaultProgressBarStyles,\n\t\t\tkeybindingLabel: defaultKeybindingLabelStyles,\n\t\t\tlist: getListStyles({\n\t\t\t\tlistBackground: quickInputBackground,\n\t\t\t\tlistFocusBackground: quickInputListFocusBackground,\n\t\t\t\tlistFocusForeground: quickInputListFocusForeground,\n\t\t\t\t// Look like focused when inactive.\n\t\t\t\tlistInactiveFocusForeground: quickInputListFocusForeground,\n\t\t\t\tlistInactiveSelectionIconForeground: quickInputListFocusIconForeground,\n\t\t\t\tlistInactiveFocusBackground: quickInputListFocusBackground,\n\t\t\t\tlistFocusOutline: activeContrastBorder,\n\t\t\t\tlistInactiveFocusOutline: activeContrastBorder,\n\t\t\t\ttreeStickyScrollBackground: quickInputBackground,\n\t\t\t}),\n\t\t\tpickerGroup: {\n\t\t\t\tpickerGroupBorder: asCssVariable(pickerGroupBorder),\n\t\t\t\tpickerGroupForeground: asCssVariable(pickerGroupForeground),\n\t\t\t}\n\t\t};\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { IContextKey, IContextKeyService, RawContextKey } from '../../contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../instantiation/common/instantiation.js';\nimport { ILayoutService } from '../../layout/browser/layoutService.js';\nimport { IOpenerService } from '../../opener/common/opener.js';\nimport { QuickAccessController } from './quickAccess.js';\nimport { IQuickAccessController } from '../common/quickAccess.js';\nimport { IInputBox, IInputOptions, IPickOptions, IQuickInputService, IQuickPick, IQuickPickItem, QuickPickInput } from '../common/quickInput.js';\nimport { defaultButtonStyles, defaultCountBadgeStyles, defaultInputBoxStyles, defaultKeybindingLabelStyles, defaultProgressBarStyles, defaultToggleStyles, getListStyles } from '../../theme/browser/defaultStyles.js';\nimport { activeContrastBorder, asCssVariable, pickerGroupBorder, pickerGroupForeground, quickInputBackground, quickInputForeground, quickInputListFocusBackground, quickInputListFocusForeground, quickInputListFocusIconForeground, quickInputTitleBackground, widgetBorder, widgetShadow } from '../../theme/common/colorRegistry.js';\nimport { IThemeService, Themable } from '../../theme/common/themeService.js';\nimport { IQuickInputOptions, IQuickInputStyles, QuickInputHoverDelegate } from './quickInput.js';\nimport { QuickInputController, IQuickInputControllerHost } from './quickInputController.js';\nimport { IConfigurationService } from '../../configuration/common/configuration.js';\nimport { getWindow } from '../../../base/browser/dom.js';\n\nexport class QuickInputService extends Themable implements IQuickInputService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onShow = this._register(new Emitter<void>());\n\n\tprivate readonly _onHide = this._register(new Emitter<void>());\n\n\tprivate _controller: QuickInputController | undefined;\n\tprivate get controller(): QuickInputController {\n\t\tif (!this._controller) {\n\t\t\tthis._controller = this._register(this.createController());\n\t\t}\n\n\t\treturn this._controller;\n\t}\n\n\tprivate get hasController() { return !!this._controller; }\n\tget currentQuickInput() { return this.controller.currentQuickInput; }\n\n\tprivate _quickAccess: IQuickAccessController | undefined;\n\tget quickAccess(): IQuickAccessController {\n\t\tif (!this._quickAccess) {\n\t\t\tthis._quickAccess = this._register(this.instantiationService.createInstance(QuickAccessController));\n\t\t}\n\n\t\treturn this._quickAccess;\n\t}\n\n\tprivate readonly contexts = new Map<string, IContextKey<boolean>>();\n\n\tconstructor(\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IContextKeyService protected readonly contextKeyService: IContextKeyService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@ILayoutService protected readonly layoutService: ILayoutService,\n\t\t@IConfigurationService protected readonly configurationService: IConfigurationService,\n\t) {\n\t\tsuper(themeService);\n\t}\n\n\tprotected createController(host: IQuickInputControllerHost = this.layoutService, options?: Partial<IQuickInputOptions>): QuickInputController {\n\t\tconst defaultOptions: IQuickInputOptions = {\n\t\t\tidPrefix: 'quickInput_',\n\t\t\tcontainer: host.activeContainer,\n\t\t\tignoreFocusOut: () => false,\n\t\t\tbackKeybindingLabel: () => undefined,\n\t\t\tsetContextKey: (id?: string) => this.setContextKey(id),\n\t\t\tlinkOpenerDelegate: (content) => {\n\t\t\t\t// HACK: https://github.com/microsoft/vscode/issues/173691\n\t\t\t\tthis.instantiationService.invokeFunction(accessor => {\n\t\t\t\t\tconst openerService = accessor.get(IOpenerService);\n\t\t\t\t\topenerService.open(content, { allowCommands: true, fromUserGesture: true });\n\t\t\t\t});\n\t\t\t},\n\t\t\treturnFocus: () => host.focus(),\n\t\t\tstyles: this.computeStyles(),\n\t\t\thoverDelegate: this._register(this.instantiationService.createInstance(QuickInputHoverDelegate))\n\t\t};\n\n\t\tconst controller = this._register(this.instantiationService.createInstance(\n\t\t\tQuickInputController,\n\t\t\t{\n\t\t\t\t...defaultOptions,\n\t\t\t\t...options\n\t\t\t}\n\t\t));\n\n\t\tcontroller.layout(host.activeContainerDimension, host.activeContainerOffset.quickPickTop);\n\n\t\t// Layout changes\n\t\tthis._register(host.onDidLayoutActiveContainer(dimension => {\n\t\t\tif (getWindow(host.activeContainer) === getWindow(controller.container)) {\n\t\t\t\tcontroller.layout(dimension, host.activeContainerOffset.quickPickTop);\n\t\t\t}\n\t\t}));\n\t\tthis._register(host.onDidChangeActiveContainer(() => {\n\t\t\tif (controller.isVisible()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcontroller.layout(host.activeContainerDimension, host.activeContainerOffset.quickPickTop);\n\t\t}));\n\n\t\t// Context keys\n\t\tthis._register(controller.onShow(() => {\n\t\t\tthis.resetContextKeys();\n\t\t\tthis._onShow.fire();\n\t\t}));\n\t\tthis._register(controller.onHide(() => {\n\t\t\tthis.resetContextKeys();\n\t\t\tthis._onHide.fire();\n\t\t}));\n\n\t\treturn controller;\n\t}\n\n\tprivate setContextKey(id?: string) {\n\t\tlet key: IContextKey<boolean> | undefined;\n\t\tif (id) {\n\t\t\tkey = this.contexts.get(id);\n\t\t\tif (!key) {\n\t\t\t\tkey = new RawContextKey<boolean>(id, false)\n\t\t\t\t\t.bindTo(this.contextKeyService);\n\t\t\t\tthis.contexts.set(id, key);\n\t\t\t}\n\t\t}\n\n\t\tif (key && key.get()) {\n\t\t\treturn; // already active context\n\t\t}\n\n\t\tthis.resetContextKeys();\n\n\t\tkey?.set(true);\n\t}\n\n\tprivate resetContextKeys() {\n\t\tthis.contexts.forEach(context => {\n\t\t\tif (context.get()) {\n\t\t\t\tcontext.reset();\n\t\t\t}\n\t\t});\n\t}\n\n\tpick<T extends IQuickPickItem, O extends IPickOptions<T>>(picks: Promise<QuickPickInput<T>[]> | QuickPickInput<T>[], options?: O, token: CancellationToken = CancellationToken.None): Promise<(O extends { canPickMany: true } ? T[] : T) | undefined> {\n\t\treturn this.controller.pick(picks, options, token);\n\t}\n\n\tinput(options: IInputOptions = {}, token: CancellationToken = CancellationToken.None): Promise<string | undefined> {\n\t\treturn this.controller.input(options, token);\n\t}\n\n\tcreateQuickPick<T extends IQuickPickItem>(options: { useSeparators: true }): IQuickPick<T, { useSeparators: true }>;\n\tcreateQuickPick<T extends IQuickPickItem>(options?: { useSeparators: boolean }): IQuickPick<T, { useSeparators: false }>;\n\tcreateQuickPick<T extends IQuickPickItem>(options: { useSeparators: boolean } = { useSeparators: false }): IQuickPick<T, { useSeparators: boolean }> {\n\t\treturn this.controller.createQuickPick(options);\n\t}\n\n\tcreateInputBox(): IInputBox {\n\t\treturn this.controller.createInputBox();\n\t}\n\n\ttoggleHover(): void {\n\t\tif (this.hasController) {\n\t\t\tthis.controller.toggleHover();\n\t\t}\n\t}\n\n\toverride updateStyles() {\n\t\tif (this.hasController) {\n\t\t\tthis.controller.applyStyles(this.computeStyles());\n\t\t}\n\t}\n\n\tprivate computeStyles(): IQuickInputStyles {\n\t\treturn {\n\t\t\twidget: {\n\t\t\t\tquickInputBackground: asCssVariable(quickInputBackground),\n\t\t\t\tquickInputForeground: asCssVariable(quickInputForeground),\n\t\t\t\tquickInputTitleBackground: asCssVariable(quickInputTitleBackground),\n\t\t\t\twidgetBorder: asCssVariable(widgetBorder),\n\t\t\t\twidgetShadow: asCssVariable(widgetShadow),\n\t\t\t},\n\t\t\tinputBox: defaultInputBoxStyles,\n\t\t\ttoggle: defaultToggleStyles,\n\t\t\tcountBadge: defaultCountBadgeStyles,\n\t\t\tbutton: defaultButtonStyles,\n\t\t\tprogressBar: defaultProgressBarStyles,\n\t\t\tkeybindingLabel: defaultKeybindingLabelStyles,\n\t\t\tlist: getListStyles({\n\t\t\t\tlistBackground: quickInputBackground,\n\t\t\t\tlistFocusBackground: quickInputListFocusBackground,\n\t\t\t\tlistFocusForeground: quickInputListFocusForeground,\n\t\t\t\t// Look like focused when inactive.\n\t\t\t\tlistInactiveFocusForeground: quickInputListFocusForeground,\n\t\t\t\tlistInactiveSelectionIconForeground: quickInputListFocusIconForeground,\n\t\t\t\tlistInactiveFocusBackground: quickInputListFocusBackground,\n\t\t\t\tlistFocusOutline: activeContrastBorder,\n\t\t\t\tlistInactiveFocusOutline: activeContrastBorder,\n\t\t\t\ttreeStickyScrollBackground: quickInputBackground,\n\t\t\t}),\n\t\t\tpickerGroup: {\n\t\t\t\tpickerGroupBorder: asCssVariable(pickerGroupBorder),\n\t\t\t\tpickerGroupForeground: asCssVariable(pickerGroupForeground),\n\t\t\t}\n\t\t};\n\t}\n}\n"]}