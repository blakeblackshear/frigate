{"version":3,"sources":["vs/platform/history/browser/contextScopedHistoryWidget.ts"],"names":[],"mappings":"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","file":"contextScopedHistoryWidget.js","sourceRoot":"file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IHistoryNavigationWidget } from '../../../base/browser/history.js';\nimport { IContextViewProvider } from '../../../base/browser/ui/contextview/contextview.js';\nimport { FindInput, IFindInputOptions } from '../../../base/browser/ui/findinput/findInput.js';\nimport { IReplaceInputOptions, ReplaceInput } from '../../../base/browser/ui/findinput/replaceInput.js';\nimport { KeyCode, KeyMod } from '../../../base/common/keyCodes.js';\nimport { ContextKeyExpr, IContextKey, IContextKeyService, RawContextKey } from '../../contextkey/common/contextkey.js';\nimport { KeybindingsRegistry, KeybindingWeight } from '../../keybinding/common/keybindingsRegistry.js';\nimport { localize } from '../../../nls.js';\nimport { DisposableStore, IDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { isActiveElement } from '../../../base/browser/dom.js';\n\nexport const historyNavigationVisible = new RawContextKey<boolean>('suggestWidgetVisible', false, localize('suggestWidgetVisible', \"Whether suggestion are visible\"));\n\nconst HistoryNavigationWidgetFocusContext = 'historyNavigationWidgetFocus';\nconst HistoryNavigationForwardsEnablementContext = 'historyNavigationForwardsEnabled';\nconst HistoryNavigationBackwardsEnablementContext = 'historyNavigationBackwardsEnabled';\n\nexport interface IHistoryNavigationContext extends IDisposable {\n\thistoryNavigationForwardsEnablement: IContextKey<boolean>;\n\thistoryNavigationBackwardsEnablement: IContextKey<boolean>;\n}\n\nlet lastFocusedWidget: IHistoryNavigationWidget | undefined = undefined;\nconst widgets: IHistoryNavigationWidget[] = [];\n\nexport function registerAndCreateHistoryNavigationContext(scopedContextKeyService: IContextKeyService, widget: IHistoryNavigationWidget): IHistoryNavigationContext {\n\tif (widgets.includes(widget)) {\n\t\tthrow new Error('Cannot register the same widget multiple times');\n\t}\n\n\twidgets.push(widget);\n\tconst disposableStore = new DisposableStore();\n\tconst historyNavigationWidgetFocus = new RawContextKey<boolean>(HistoryNavigationWidgetFocusContext, false).bindTo(scopedContextKeyService);\n\tconst historyNavigationForwardsEnablement = new RawContextKey<boolean>(HistoryNavigationForwardsEnablementContext, true).bindTo(scopedContextKeyService);\n\tconst historyNavigationBackwardsEnablement = new RawContextKey<boolean>(HistoryNavigationBackwardsEnablementContext, true).bindTo(scopedContextKeyService);\n\n\tconst onDidFocus = () => {\n\t\thistoryNavigationWidgetFocus.set(true);\n\t\tlastFocusedWidget = widget;\n\t};\n\n\tconst onDidBlur = () => {\n\t\thistoryNavigationWidgetFocus.set(false);\n\t\tif (lastFocusedWidget === widget) {\n\t\t\tlastFocusedWidget = undefined;\n\t\t}\n\t};\n\n\t// Check for currently being focused\n\tif (isActiveElement(widget.element)) {\n\t\tonDidFocus();\n\t}\n\n\tdisposableStore.add(widget.onDidFocus(() => onDidFocus()));\n\tdisposableStore.add(widget.onDidBlur(() => onDidBlur()));\n\tdisposableStore.add(toDisposable(() => {\n\t\twidgets.splice(widgets.indexOf(widget), 1);\n\t\tonDidBlur();\n\t}));\n\n\treturn {\n\t\thistoryNavigationForwardsEnablement,\n\t\thistoryNavigationBackwardsEnablement,\n\t\tdispose() {\n\t\t\tdisposableStore.dispose();\n\t\t}\n\t};\n}\n\nexport class ContextScopedFindInput extends FindInput {\n\n\tconstructor(container: HTMLElement | null, contextViewProvider: IContextViewProvider, options: IFindInputOptions,\n\t\t@IContextKeyService contextKeyService: IContextKeyService\n\t) {\n\t\tsuper(container, contextViewProvider, options);\n\t\tconst scopedContextKeyService = this._register(contextKeyService.createScoped(this.inputBox.element));\n\t\tthis._register(registerAndCreateHistoryNavigationContext(scopedContextKeyService, this.inputBox));\n\t}\n}\n\nexport class ContextScopedReplaceInput extends ReplaceInput {\n\n\tconstructor(container: HTMLElement | null, contextViewProvider: IContextViewProvider | undefined, options: IReplaceInputOptions,\n\t\t@IContextKeyService contextKeyService: IContextKeyService, showReplaceOptions: boolean = false\n\t) {\n\t\tsuper(container, contextViewProvider, showReplaceOptions, options);\n\t\tconst scopedContextKeyService = this._register(contextKeyService.createScoped(this.inputBox.element));\n\t\tthis._register(registerAndCreateHistoryNavigationContext(scopedContextKeyService, this.inputBox));\n\t}\n\n}\n\nKeybindingsRegistry.registerCommandAndKeybindingRule({\n\tid: 'history.showPrevious',\n\tweight: KeybindingWeight.WorkbenchContrib,\n\twhen: ContextKeyExpr.and(\n\t\tContextKeyExpr.has(HistoryNavigationWidgetFocusContext),\n\t\tContextKeyExpr.equals(HistoryNavigationBackwardsEnablementContext, true),\n\t\tContextKeyExpr.not('isComposing'),\n\t\thistoryNavigationVisible.isEqualTo(false),\n\t),\n\tprimary: KeyCode.UpArrow,\n\tsecondary: [KeyMod.Alt | KeyCode.UpArrow],\n\thandler: (accessor) => {\n\t\tlastFocusedWidget?.showPreviousValue();\n\t}\n});\n\nKeybindingsRegistry.registerCommandAndKeybindingRule({\n\tid: 'history.showNext',\n\tweight: KeybindingWeight.WorkbenchContrib,\n\twhen: ContextKeyExpr.and(\n\t\tContextKeyExpr.has(HistoryNavigationWidgetFocusContext),\n\t\tContextKeyExpr.equals(HistoryNavigationForwardsEnablementContext, true),\n\t\tContextKeyExpr.not('isComposing'),\n\t\thistoryNavigationVisible.isEqualTo(false),\n\t),\n\tprimary: KeyCode.DownArrow,\n\tsecondary: [KeyMod.Alt | KeyCode.DownArrow],\n\thandler: (accessor) => {\n\t\tlastFocusedWidget?.showNextValue();\n\t}\n});\n"]}