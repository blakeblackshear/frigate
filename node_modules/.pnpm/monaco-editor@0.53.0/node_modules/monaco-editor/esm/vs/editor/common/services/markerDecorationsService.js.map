{"version":3,"sources":["file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src/vs/editor/common/services/markerDecorationsService.ts","vs/editor/common/services/markerDecorationsService.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,cAAc,EAAW,cAAc,EAAa,MAAM,6CAA6C,CAAC;AACjH,OAAO,EAAE,UAAU,EAAE,YAAY,EAAE,MAAM,mCAAmC,CAAC;AAE7E,OAAO,EAAsF,iBAAiB,EAAqE,MAAM,aAAa,CAAC;AAEvM,OAAO,EAAE,gBAAgB,EAAE,MAAM,gDAAgD,CAAC;AAElF,OAAO,EAAE,oBAAoB,EAAE,iBAAiB,EAAE,kBAAkB,EAAE,MAAM,gCAAgC,CAAC;AAC7G,OAAO,EAAE,aAAa,EAAE,MAAM,YAAY,CAAC;AAC3C,OAAO,EAAE,KAAK,EAAE,MAAM,kBAAkB,CAAC;AAEzC,OAAO,EAAE,OAAO,EAAE,MAAM,iCAAiC,CAAC;AAC1D,OAAO,EAAE,OAAO,EAAE,MAAM,+BAA+B,CAAC;AACxD,OAAO,EAAE,WAAW,EAAE,cAAc,EAAE,YAAY,EAAE,MAAM,iDAAiD,CAAC;AAC5G,OAAO,EAAE,gBAAgB,EAAE,WAAW,EAAE,MAAM,6BAA6B,CAAC;AAC5E,OAAO,EAAE,QAAQ,EAAE,MAAM,qCAAqC,CAAC;AAC/D,OAAO,EAAE,QAAQ,EAAE,MAAM,kCAAkC,CAAC;AAErD,IAAM,wBAAwB,GAA9B,MAAM,wBAAyB,SAAQ,UAAU;IAUvD,YACgB,YAA2B,EAC1B,cAA+C;QAE/D,KAAK,EAAE,CAAC;QAFyB,mBAAc,GAAd,cAAc,CAAgB;QAR/C,uBAAkB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAc,CAAC,CAAC;QAE/D,sBAAiB,GAAG,IAAI,WAAW,EAAc,CAAC;QAElD,uBAAkB,GAAG,IAAI,WAAW,EAAqB,CAAC;QAO1E,YAAY,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,CAAC;QACrE,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,YAAY,CAAC,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC,CAAC;QACpE,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,cAAc,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC,CAAC;QACxE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,IAAI,CAAC,mBAAmB,EAAE,IAAI,CAAC,CAAC,CAAC;IACrF,CAAC;IAEQ,OAAO;QACf,KAAK,CAAC,OAAO,EAAE,CAAC;QAChB,IAAI,CAAC,kBAAkB,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;QAC1D,IAAI,CAAC,kBAAkB,CAAC,KAAK,EAAE,CAAC;IACjC,CAAC;IAED,SAAS,CAAC,GAAQ,EAAE,UAA4B;QAC/C,MAAM,iBAAiB,GAAG,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QAC3D,OAAO,iBAAiB,CAAC,CAAC,CAAC,CAAC,iBAAiB,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;IACrF,CAAC;IAEO,mBAAmB,CAAC,gBAAgC;QAC3D,gBAAgB,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,EAAE;YACrC,MAAM,iBAAiB,GAAG,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;YAChE,IAAI,iBAAiB,EAAE,CAAC;gBACvB,IAAI,CAAC,kBAAkB,CAAC,iBAAiB,CAAC,CAAC;YAC5C,CAAC;QACF,CAAC,CAAC,CAAC;IACJ,CAAC;IAEO,aAAa,CAAC,KAAiB;QACtC,MAAM,iBAAiB,GAAG,IAAI,iBAAiB,CAAC,KAAK,CAAC,CAAC;QACvD,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,EAAE,iBAAiB,CAAC,CAAC;QAC1D,IAAI,CAAC,kBAAkB,CAAC,iBAAiB,CAAC,CAAC;IAC5C,CAAC;IAEO,eAAe,CAAC,KAAiB;QACxC,MAAM,iBAAiB,GAAG,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACjE,IAAI,iBAAiB,EAAE,CAAC;YACvB,iBAAiB,CAAC,OAAO,EAAE,CAAC;YAC5B,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAC3C,CAAC;QAED,kDAAkD;QAClD,IAAI,KAAK,CAAC,GAAG,CAAC,MAAM,KAAK,OAAO,CAAC,QAAQ;eACrC,KAAK,CAAC,GAAG,CAAC,MAAM,KAAK,OAAO,CAAC,QAAQ;eACrC,KAAK,CAAC,GAAG,CAAC,MAAM,KAAK,OAAO,CAAC,MAAM,EAAE,CAAC;YACzC,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,EAAE,QAAQ,EAAE,KAAK,CAAC,GAAG,EAAE,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QACjJ,CAAC;IACF,CAAC;IAEO,kBAAkB,CAAC,iBAAoC;QAC9D,yCAAyC;QACzC,IAAI,OAAO,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,iBAAiB,CAAC,KAAK,CAAC,GAAG,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,CAAC;QAE7F,wCAAwC;QACxC,MAAM,gBAAgB,GAAG,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,iBAAiB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACjF,IAAI,gBAAgB,EAAE,CAAC;YACtB,OAAO,GAAG,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE;gBACjC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,gBAAgB,EAAE,SAAS,CAAC,EAAE,CAAC,KAAK,CAAC,yBAAyB,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC,CAAC;YAC1G,CAAC,CAAC,CAAC;QACJ,CAAC;QAED,IAAI,iBAAiB,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;YACvC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;QACvD,CAAC;IACF,CAAC;CACD,CAAA;AA9EY,wBAAwB;IAWlC,WAAA,aAAa,CAAA;IACb,WAAA,cAAc,CAAA;GAZJ,wBAAwB,CA8EpC;;AAED,MAAM,iBAAkB,SAAQ,UAAU;IAIzC,YACU,KAAiB;QAE1B,KAAK,EAAE,CAAC;QAFC,UAAK,GAAL,KAAK,CAAY;QAHV,SAAI,GAAG,IAAI,gBAAgB,EAAoC,CAAC;QAMhF,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,GAAG,EAAE;YAChC,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;YACzD,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;QACnB,CAAC,CAAC,CAAC,CAAC;IACL,CAAC;IAEM,MAAM,CAAC,OAAkB;QAE/B,gFAAgF;QAChF,uFAAuF;QAEvF,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG,QAAQ,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,EAAE,IAAI,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC;QAEjF,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC,IAAI,OAAO,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YAChD,OAAO,KAAK,CAAC;QACd,CAAC;QAED,MAAM,MAAM,GAAa,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAE,CAAC,CAAC;QACvE,MAAM,cAAc,GAA4B,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE;YAClE,OAAO;gBACN,KAAK,EAAE,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,KAAK,EAAE,MAAM,CAAC;gBACtD,OAAO,EAAE,IAAI,CAAC,uBAAuB,CAAC,MAAM,CAAC;aAC7C,CAAC;QACH,CAAC,CAAC,CAAC;QAEH,MAAM,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,MAAM,EAAE,cAAc,CAAC,CAAC;QAChE,KAAK,MAAM,aAAa,IAAI,OAAO,EAAE,CAAC;YACrC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;QACjC,CAAC;QACD,KAAK,IAAI,KAAK,GAAG,CAAC,EAAE,KAAK,GAAG,GAAG,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE,CAAC;YACjD,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC;QACzC,CAAC;QACD,OAAO,IAAI,CAAC;IACb,CAAC;IAED,SAAS,CAAC,UAA4B;QACrC,OAAO,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;IACxC,CAAC;IAEO,sBAAsB,CAAC,KAAiB,EAAE,SAAkB;QAEnE,IAAI,GAAG,GAAG,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QAEhC,IAAI,SAAS,CAAC,QAAQ,KAAK,cAAc,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,SAAS,gCAAwB,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,SAAS,+BAAuB,EAAE,CAAC;YACjK,yCAAyC;YACzC,qCAAqC;YACrC,GAAG,GAAG,GAAG,CAAC,cAAc,CAAC,GAAG,CAAC,eAAe,EAAE,GAAG,CAAC,WAAW,GAAG,CAAC,CAAC,CAAC;QACpE,CAAC;QAED,GAAG,GAAG,KAAK,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;QAE/B,IAAI,GAAG,CAAC,OAAO,EAAE,EAAE,CAAC;YACnB,MAAM,SAAS,GAAG,KAAK,CAAC,8BAA8B,CAAC,GAAG,CAAC,eAAe,CAAC;gBAC1E,KAAK,CAAC,gBAAgB,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;YAE7C,IAAI,SAAS,KAAK,CAAC,IAAI,GAAG,CAAC,SAAS,IAAI,SAAS,EAAE,CAAC;gBACnD,2BAA2B;gBAC3B,qDAAqD;gBACrD,OAAO,GAAG,CAAC;YACZ,CAAC;YAED,MAAM,IAAI,GAAG,KAAK,CAAC,iBAAiB,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC,CAAC;YAC7D,IAAI,IAAI,EAAE,CAAC;gBACV,GAAG,GAAG,IAAI,KAAK,CAAC,GAAG,CAAC,eAAe,EAAE,IAAI,CAAC,WAAW,EAAE,GAAG,CAAC,aAAa,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;YAC3F,CAAC;QACF,CAAC;aAAM,IAAI,SAAS,CAAC,SAAS,KAAK,MAAM,CAAC,SAAS,IAAI,SAAS,CAAC,WAAW,KAAK,CAAC,IAAI,GAAG,CAAC,eAAe,KAAK,GAAG,CAAC,aAAa,EAAE,CAAC;YACjI,MAAM,SAAS,GAAG,KAAK,CAAC,+BAA+B,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC;YACnF,IAAI,SAAS,GAAG,GAAG,CAAC,SAAS,EAAE,CAAC;gBAC/B,GAAG,GAAG,IAAI,KAAK,CAAC,GAAG,CAAC,eAAe,EAAE,SAAS,EAAE,GAAG,CAAC,aAAa,EAAE,GAAG,CAAC,SAAS,CAAC,CAAC;gBAClF,SAAS,CAAC,WAAW,GAAG,SAAS,CAAC;YACnC,CAAC;QACF,CAAC;QACD,OAAO,GAAG,CAAC;IACZ,CAAC;IAEO,uBAAuB,CAAC,MAAe;QAE9C,IAAI,SAA6B,CAAC;QAClC,IAAI,KAAK,GAA2B,SAAS,CAAC;QAC9C,IAAI,MAAc,CAAC;QACnB,IAAI,eAAe,GAAuB,SAAS,CAAC;QACpD,IAAI,OAAmD,CAAC;QAExD,QAAQ,MAAM,CAAC,QAAQ,EAAE,CAAC;YACzB,KAAK,cAAc,CAAC,IAAI;gBACvB,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,+BAAuB,EAAE,CAAC;oBACtD,SAAS,GAAG,SAAS,CAAC;gBACvB,CAAC;qBAAM,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,gCAAwB,EAAE,CAAC;oBAC9D,SAAS,qEAAwC,CAAC;gBACnD,CAAC;qBAAM,CAAC;oBACP,SAAS,uDAAiC,CAAC;gBAC5C,CAAC;gBACD,MAAM,GAAG,CAAC,CAAC;gBACX,MAAM;YACP,KAAK,cAAc,CAAC,IAAI;gBACvB,SAAS,uDAAiC,CAAC;gBAC3C,KAAK,GAAG,gBAAgB,CAAC,iBAAiB,CAAC,CAAC;gBAC5C,MAAM,GAAG,EAAE,CAAC;gBACZ,OAAO,GAAG;oBACT,KAAK,EAAE,gBAAgB,CAAC,WAAW,CAAC;oBACpC,QAAQ,gCAAwB;iBAChC,CAAC;gBACF,MAAM;YACP,KAAK,cAAc,CAAC,OAAO;gBAC1B,SAAS,6DAAoC,CAAC;gBAC9C,KAAK,GAAG,gBAAgB,CAAC,oBAAoB,CAAC,CAAC;gBAC/C,MAAM,GAAG,EAAE,CAAC;gBACZ,OAAO,GAAG;oBACT,KAAK,EAAE,gBAAgB,CAAC,cAAc,CAAC;oBACvC,QAAQ,gCAAwB;iBAChC,CAAC;gBACF,MAAM;YACP,KAAK,cAAc,CAAC,KAAK,CAAC;YAC1B;gBACC,SAAS,yDAAkC,CAAC;gBAC5C,KAAK,GAAG,gBAAgB,CAAC,kBAAkB,CAAC,CAAC;gBAC7C,MAAM,GAAG,EAAE,CAAC;gBACZ,OAAO,GAAG;oBACT,KAAK,EAAE,gBAAgB,CAAC,YAAY,CAAC;oBACrC,QAAQ,gCAAwB;iBAChC,CAAC;gBACF,MAAM;QACR,CAAC;QAED,IAAI,MAAM,CAAC,IAAI,EAAE,CAAC;YACjB,IAAI,MAAM,CAAC,IAAI,CAAC,OAAO,+BAAuB,KAAK,CAAC,CAAC,EAAE,CAAC;gBACvD,eAAe,kFAA8C,CAAC;YAC/D,CAAC;YACD,IAAI,MAAM,CAAC,IAAI,CAAC,OAAO,8BAAsB,KAAK,CAAC,CAAC,EAAE,CAAC;gBACtD,eAAe,gFAA6C,CAAC;YAC9D,CAAC;QACF,CAAC;QAED,OAAO;YACN,WAAW,EAAE,mBAAmB;YAChC,UAAU,4DAAoD;YAC9D,SAAS;YACT,eAAe,EAAE,IAAI;YACrB,aAAa,EAAE;gBACd,KAAK;gBACL,QAAQ,EAAE,iBAAiB,CAAC,KAAK;aACjC;YACD,OAAO;YACP,MAAM;YACN,eAAe;SACf,CAAC;IACH,CAAC;IAEO,aAAa,CAAC,MAAe,EAAE,GAAc;QACpD,IAAI,MAAM,CAAC,IAAI,EAAE,CAAC;YACjB,OAAO,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QACtC,CAAC;QACD,OAAO,KAAK,CAAC;IACd,CAAC;CACD","file":"markerDecorationsService.js","sourceRoot":"file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IMarkerService, IMarker, MarkerSeverity, MarkerTag } from '../../../platform/markers/common/markers.js';\nimport { Disposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IModelDeltaDecoration, ITextModel, IModelDecorationOptions, TrackedRangeStickiness, OverviewRulerLane, IModelDecoration, MinimapPosition, IModelDecorationMinimapOptions } from '../model.js';\nimport { ClassName } from '../model/intervalTree.js';\nimport { themeColorFromId } from '../../../platform/theme/common/themeService.js';\nimport { ThemeColor } from '../../../base/common/themables.js';\nimport { overviewRulerWarning, overviewRulerInfo, overviewRulerError } from '../core/editorColorRegistry.js';\nimport { IModelService } from './model.js';\nimport { Range } from '../core/range.js';\nimport { IMarkerDecorationsService } from './markerDecorations.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { minimapInfo, minimapWarning, minimapError } from '../../../platform/theme/common/colorRegistry.js';\nimport { BidirectionalMap, ResourceMap } from '../../../base/common/map.js';\nimport { diffSets } from '../../../base/common/collections.js';\nimport { Iterable } from '../../../base/common/iterator.js';\n\nexport class MarkerDecorationsService extends Disposable implements IMarkerDecorationsService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onDidChangeMarker = this._register(new Emitter<ITextModel>());\n\n\tprivate readonly _suppressedRanges = new ResourceMap<Set<Range>>();\n\n\tprivate readonly _markerDecorations = new ResourceMap<MarkerDecorations>();\n\n\tconstructor(\n\t\t@IModelService modelService: IModelService,\n\t\t@IMarkerService private readonly _markerService: IMarkerService\n\t) {\n\t\tsuper();\n\t\tmodelService.getModels().forEach(model => this._onModelAdded(model));\n\t\tthis._register(modelService.onModelAdded(this._onModelAdded, this));\n\t\tthis._register(modelService.onModelRemoved(this._onModelRemoved, this));\n\t\tthis._register(this._markerService.onMarkerChanged(this._handleMarkerChange, this));\n\t}\n\n\toverride dispose() {\n\t\tsuper.dispose();\n\t\tthis._markerDecorations.forEach(value => value.dispose());\n\t\tthis._markerDecorations.clear();\n\t}\n\n\tgetMarker(uri: URI, decoration: IModelDecoration): IMarker | null {\n\t\tconst markerDecorations = this._markerDecorations.get(uri);\n\t\treturn markerDecorations ? (markerDecorations.getMarker(decoration) || null) : null;\n\t}\n\n\tprivate _handleMarkerChange(changedResources: readonly URI[]): void {\n\t\tchangedResources.forEach((resource) => {\n\t\t\tconst markerDecorations = this._markerDecorations.get(resource);\n\t\t\tif (markerDecorations) {\n\t\t\t\tthis._updateDecorations(markerDecorations);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _onModelAdded(model: ITextModel): void {\n\t\tconst markerDecorations = new MarkerDecorations(model);\n\t\tthis._markerDecorations.set(model.uri, markerDecorations);\n\t\tthis._updateDecorations(markerDecorations);\n\t}\n\n\tprivate _onModelRemoved(model: ITextModel): void {\n\t\tconst markerDecorations = this._markerDecorations.get(model.uri);\n\t\tif (markerDecorations) {\n\t\t\tmarkerDecorations.dispose();\n\t\t\tthis._markerDecorations.delete(model.uri);\n\t\t}\n\n\t\t// clean up markers for internal, transient models\n\t\tif (model.uri.scheme === Schemas.inMemory\n\t\t\t|| model.uri.scheme === Schemas.internal\n\t\t\t|| model.uri.scheme === Schemas.vscode) {\n\t\t\tthis._markerService?.read({ resource: model.uri }).map(marker => marker.owner).forEach(owner => this._markerService.remove(owner, [model.uri]));\n\t\t}\n\t}\n\n\tprivate _updateDecorations(markerDecorations: MarkerDecorations): void {\n\t\t// Limit to the first 500 errors/warnings\n\t\tlet markers = this._markerService.read({ resource: markerDecorations.model.uri, take: 500 });\n\n\t\t// filter markers from suppressed ranges\n\t\tconst suppressedRanges = this._suppressedRanges.get(markerDecorations.model.uri);\n\t\tif (suppressedRanges) {\n\t\t\tmarkers = markers.filter(marker => {\n\t\t\t\treturn !Iterable.some(suppressedRanges, candidate => Range.areIntersectingOrTouching(candidate, marker));\n\t\t\t});\n\t\t}\n\n\t\tif (markerDecorations.update(markers)) {\n\t\t\tthis._onDidChangeMarker.fire(markerDecorations.model);\n\t\t}\n\t}\n}\n\nclass MarkerDecorations extends Disposable {\n\n\tprivate readonly _map = new BidirectionalMap<IMarker, /*decoration id*/string>();\n\n\tconstructor(\n\t\treadonly model: ITextModel\n\t) {\n\t\tsuper();\n\t\tthis._register(toDisposable(() => {\n\t\t\tthis.model.deltaDecorations([...this._map.values()], []);\n\t\t\tthis._map.clear();\n\t\t}));\n\t}\n\n\tpublic update(markers: IMarker[]): boolean {\n\n\t\t// We use the fact that marker instances are not recreated when different owners\n\t\t// update. So we can compare references to find out what changed since the last update.\n\n\t\tconst { added, removed } = diffSets(new Set(this._map.keys()), new Set(markers));\n\n\t\tif (added.length === 0 && removed.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst oldIds: string[] = removed.map(marker => this._map.get(marker)!);\n\t\tconst newDecorations: IModelDeltaDecoration[] = added.map(marker => {\n\t\t\treturn {\n\t\t\t\trange: this._createDecorationRange(this.model, marker),\n\t\t\t\toptions: this._createDecorationOption(marker)\n\t\t\t};\n\t\t});\n\n\t\tconst ids = this.model.deltaDecorations(oldIds, newDecorations);\n\t\tfor (const removedMarker of removed) {\n\t\t\tthis._map.delete(removedMarker);\n\t\t}\n\t\tfor (let index = 0; index < ids.length; index++) {\n\t\t\tthis._map.set(added[index], ids[index]);\n\t\t}\n\t\treturn true;\n\t}\n\n\tgetMarker(decoration: IModelDecoration): IMarker | undefined {\n\t\treturn this._map.getKey(decoration.id);\n\t}\n\n\tprivate _createDecorationRange(model: ITextModel, rawMarker: IMarker): Range {\n\n\t\tlet ret = Range.lift(rawMarker);\n\n\t\tif (rawMarker.severity === MarkerSeverity.Hint && !this._hasMarkerTag(rawMarker, MarkerTag.Unnecessary) && !this._hasMarkerTag(rawMarker, MarkerTag.Deprecated)) {\n\t\t\t// * never render hints on multiple lines\n\t\t\t// * make enough space for three dots\n\t\t\tret = ret.setEndPosition(ret.startLineNumber, ret.startColumn + 2);\n\t\t}\n\n\t\tret = model.validateRange(ret);\n\n\t\tif (ret.isEmpty()) {\n\t\t\tconst maxColumn = model.getLineLastNonWhitespaceColumn(ret.startLineNumber) ||\n\t\t\t\tmodel.getLineMaxColumn(ret.startLineNumber);\n\n\t\t\tif (maxColumn === 1 || ret.endColumn >= maxColumn) {\n\t\t\t\t// empty line or behind eol\n\t\t\t\t// keep the range as is, it will be rendered 1ch wide\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\tconst word = model.getWordAtPosition(ret.getStartPosition());\n\t\t\tif (word) {\n\t\t\t\tret = new Range(ret.startLineNumber, word.startColumn, ret.endLineNumber, word.endColumn);\n\t\t\t}\n\t\t} else if (rawMarker.endColumn === Number.MAX_VALUE && rawMarker.startColumn === 1 && ret.startLineNumber === ret.endLineNumber) {\n\t\t\tconst minColumn = model.getLineFirstNonWhitespaceColumn(rawMarker.startLineNumber);\n\t\t\tif (minColumn < ret.endColumn) {\n\t\t\t\tret = new Range(ret.startLineNumber, minColumn, ret.endLineNumber, ret.endColumn);\n\t\t\t\trawMarker.startColumn = minColumn;\n\t\t\t}\n\t\t}\n\t\treturn ret;\n\t}\n\n\tprivate _createDecorationOption(marker: IMarker): IModelDecorationOptions {\n\n\t\tlet className: string | undefined;\n\t\tlet color: ThemeColor | undefined = undefined;\n\t\tlet zIndex: number;\n\t\tlet inlineClassName: string | undefined = undefined;\n\t\tlet minimap: IModelDecorationMinimapOptions | undefined;\n\n\t\tswitch (marker.severity) {\n\t\t\tcase MarkerSeverity.Hint:\n\t\t\t\tif (this._hasMarkerTag(marker, MarkerTag.Deprecated)) {\n\t\t\t\t\tclassName = undefined;\n\t\t\t\t} else if (this._hasMarkerTag(marker, MarkerTag.Unnecessary)) {\n\t\t\t\t\tclassName = ClassName.EditorUnnecessaryDecoration;\n\t\t\t\t} else {\n\t\t\t\t\tclassName = ClassName.EditorHintDecoration;\n\t\t\t\t}\n\t\t\t\tzIndex = 0;\n\t\t\t\tbreak;\n\t\t\tcase MarkerSeverity.Info:\n\t\t\t\tclassName = ClassName.EditorInfoDecoration;\n\t\t\t\tcolor = themeColorFromId(overviewRulerInfo);\n\t\t\t\tzIndex = 10;\n\t\t\t\tminimap = {\n\t\t\t\t\tcolor: themeColorFromId(minimapInfo),\n\t\t\t\t\tposition: MinimapPosition.Inline\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase MarkerSeverity.Warning:\n\t\t\t\tclassName = ClassName.EditorWarningDecoration;\n\t\t\t\tcolor = themeColorFromId(overviewRulerWarning);\n\t\t\t\tzIndex = 20;\n\t\t\t\tminimap = {\n\t\t\t\t\tcolor: themeColorFromId(minimapWarning),\n\t\t\t\t\tposition: MinimapPosition.Inline\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase MarkerSeverity.Error:\n\t\t\tdefault:\n\t\t\t\tclassName = ClassName.EditorErrorDecoration;\n\t\t\t\tcolor = themeColorFromId(overviewRulerError);\n\t\t\t\tzIndex = 30;\n\t\t\t\tminimap = {\n\t\t\t\t\tcolor: themeColorFromId(minimapError),\n\t\t\t\t\tposition: MinimapPosition.Inline\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (marker.tags) {\n\t\t\tif (marker.tags.indexOf(MarkerTag.Unnecessary) !== -1) {\n\t\t\t\tinlineClassName = ClassName.EditorUnnecessaryInlineDecoration;\n\t\t\t}\n\t\t\tif (marker.tags.indexOf(MarkerTag.Deprecated) !== -1) {\n\t\t\t\tinlineClassName = ClassName.EditorDeprecatedInlineDecoration;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tdescription: 'marker-decoration',\n\t\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\t\tclassName,\n\t\t\tshowIfCollapsed: true,\n\t\t\toverviewRuler: {\n\t\t\t\tcolor,\n\t\t\t\tposition: OverviewRulerLane.Right\n\t\t\t},\n\t\t\tminimap,\n\t\t\tzIndex,\n\t\t\tinlineClassName,\n\t\t};\n\t}\n\n\tprivate _hasMarkerTag(marker: IMarker, tag: MarkerTag): boolean {\n\t\tif (marker.tags) {\n\t\t\treturn marker.tags.indexOf(tag) >= 0;\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IMarkerService, IMarker, MarkerSeverity, MarkerTag } from '../../../platform/markers/common/markers.js';\nimport { Disposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IModelDeltaDecoration, ITextModel, IModelDecorationOptions, TrackedRangeStickiness, OverviewRulerLane, IModelDecoration, MinimapPosition, IModelDecorationMinimapOptions } from '../model.js';\nimport { ClassName } from '../model/intervalTree.js';\nimport { themeColorFromId } from '../../../platform/theme/common/themeService.js';\nimport { ThemeColor } from '../../../base/common/themables.js';\nimport { overviewRulerWarning, overviewRulerInfo, overviewRulerError } from '../core/editorColorRegistry.js';\nimport { IModelService } from './model.js';\nimport { Range } from '../core/range.js';\nimport { IMarkerDecorationsService } from './markerDecorations.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { minimapInfo, minimapWarning, minimapError } from '../../../platform/theme/common/colorRegistry.js';\nimport { BidirectionalMap, ResourceMap } from '../../../base/common/map.js';\nimport { diffSets } from '../../../base/common/collections.js';\nimport { Iterable } from '../../../base/common/iterator.js';\n\nexport class MarkerDecorationsService extends Disposable implements IMarkerDecorationsService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onDidChangeMarker = this._register(new Emitter<ITextModel>());\n\n\tprivate readonly _suppressedRanges = new ResourceMap<Set<Range>>();\n\n\tprivate readonly _markerDecorations = new ResourceMap<MarkerDecorations>();\n\n\tconstructor(\n\t\t@IModelService modelService: IModelService,\n\t\t@IMarkerService private readonly _markerService: IMarkerService\n\t) {\n\t\tsuper();\n\t\tmodelService.getModels().forEach(model => this._onModelAdded(model));\n\t\tthis._register(modelService.onModelAdded(this._onModelAdded, this));\n\t\tthis._register(modelService.onModelRemoved(this._onModelRemoved, this));\n\t\tthis._register(this._markerService.onMarkerChanged(this._handleMarkerChange, this));\n\t}\n\n\toverride dispose() {\n\t\tsuper.dispose();\n\t\tthis._markerDecorations.forEach(value => value.dispose());\n\t\tthis._markerDecorations.clear();\n\t}\n\n\tgetMarker(uri: URI, decoration: IModelDecoration): IMarker | null {\n\t\tconst markerDecorations = this._markerDecorations.get(uri);\n\t\treturn markerDecorations ? (markerDecorations.getMarker(decoration) || null) : null;\n\t}\n\n\tprivate _handleMarkerChange(changedResources: readonly URI[]): void {\n\t\tchangedResources.forEach((resource) => {\n\t\t\tconst markerDecorations = this._markerDecorations.get(resource);\n\t\t\tif (markerDecorations) {\n\t\t\t\tthis._updateDecorations(markerDecorations);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _onModelAdded(model: ITextModel): void {\n\t\tconst markerDecorations = new MarkerDecorations(model);\n\t\tthis._markerDecorations.set(model.uri, markerDecorations);\n\t\tthis._updateDecorations(markerDecorations);\n\t}\n\n\tprivate _onModelRemoved(model: ITextModel): void {\n\t\tconst markerDecorations = this._markerDecorations.get(model.uri);\n\t\tif (markerDecorations) {\n\t\t\tmarkerDecorations.dispose();\n\t\t\tthis._markerDecorations.delete(model.uri);\n\t\t}\n\n\t\t// clean up markers for internal, transient models\n\t\tif (model.uri.scheme === Schemas.inMemory\n\t\t\t|| model.uri.scheme === Schemas.internal\n\t\t\t|| model.uri.scheme === Schemas.vscode) {\n\t\t\tthis._markerService?.read({ resource: model.uri }).map(marker => marker.owner).forEach(owner => this._markerService.remove(owner, [model.uri]));\n\t\t}\n\t}\n\n\tprivate _updateDecorations(markerDecorations: MarkerDecorations): void {\n\t\t// Limit to the first 500 errors/warnings\n\t\tlet markers = this._markerService.read({ resource: markerDecorations.model.uri, take: 500 });\n\n\t\t// filter markers from suppressed ranges\n\t\tconst suppressedRanges = this._suppressedRanges.get(markerDecorations.model.uri);\n\t\tif (suppressedRanges) {\n\t\t\tmarkers = markers.filter(marker => {\n\t\t\t\treturn !Iterable.some(suppressedRanges, candidate => Range.areIntersectingOrTouching(candidate, marker));\n\t\t\t});\n\t\t}\n\n\t\tif (markerDecorations.update(markers)) {\n\t\t\tthis._onDidChangeMarker.fire(markerDecorations.model);\n\t\t}\n\t}\n}\n\nclass MarkerDecorations extends Disposable {\n\n\tprivate readonly _map = new BidirectionalMap<IMarker, /*decoration id*/string>();\n\n\tconstructor(\n\t\treadonly model: ITextModel\n\t) {\n\t\tsuper();\n\t\tthis._register(toDisposable(() => {\n\t\t\tthis.model.deltaDecorations([...this._map.values()], []);\n\t\t\tthis._map.clear();\n\t\t}));\n\t}\n\n\tpublic update(markers: IMarker[]): boolean {\n\n\t\t// We use the fact that marker instances are not recreated when different owners\n\t\t// update. So we can compare references to find out what changed since the last update.\n\n\t\tconst { added, removed } = diffSets(new Set(this._map.keys()), new Set(markers));\n\n\t\tif (added.length === 0 && removed.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst oldIds: string[] = removed.map(marker => this._map.get(marker)!);\n\t\tconst newDecorations: IModelDeltaDecoration[] = added.map(marker => {\n\t\t\treturn {\n\t\t\t\trange: this._createDecorationRange(this.model, marker),\n\t\t\t\toptions: this._createDecorationOption(marker)\n\t\t\t};\n\t\t});\n\n\t\tconst ids = this.model.deltaDecorations(oldIds, newDecorations);\n\t\tfor (const removedMarker of removed) {\n\t\t\tthis._map.delete(removedMarker);\n\t\t}\n\t\tfor (let index = 0; index < ids.length; index++) {\n\t\t\tthis._map.set(added[index], ids[index]);\n\t\t}\n\t\treturn true;\n\t}\n\n\tgetMarker(decoration: IModelDecoration): IMarker | undefined {\n\t\treturn this._map.getKey(decoration.id);\n\t}\n\n\tprivate _createDecorationRange(model: ITextModel, rawMarker: IMarker): Range {\n\n\t\tlet ret = Range.lift(rawMarker);\n\n\t\tif (rawMarker.severity === MarkerSeverity.Hint && !this._hasMarkerTag(rawMarker, MarkerTag.Unnecessary) && !this._hasMarkerTag(rawMarker, MarkerTag.Deprecated)) {\n\t\t\t// * never render hints on multiple lines\n\t\t\t// * make enough space for three dots\n\t\t\tret = ret.setEndPosition(ret.startLineNumber, ret.startColumn + 2);\n\t\t}\n\n\t\tret = model.validateRange(ret);\n\n\t\tif (ret.isEmpty()) {\n\t\t\tconst maxColumn = model.getLineLastNonWhitespaceColumn(ret.startLineNumber) ||\n\t\t\t\tmodel.getLineMaxColumn(ret.startLineNumber);\n\n\t\t\tif (maxColumn === 1 || ret.endColumn >= maxColumn) {\n\t\t\t\t// empty line or behind eol\n\t\t\t\t// keep the range as is, it will be rendered 1ch wide\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\tconst word = model.getWordAtPosition(ret.getStartPosition());\n\t\t\tif (word) {\n\t\t\t\tret = new Range(ret.startLineNumber, word.startColumn, ret.endLineNumber, word.endColumn);\n\t\t\t}\n\t\t} else if (rawMarker.endColumn === Number.MAX_VALUE && rawMarker.startColumn === 1 && ret.startLineNumber === ret.endLineNumber) {\n\t\t\tconst minColumn = model.getLineFirstNonWhitespaceColumn(rawMarker.startLineNumber);\n\t\t\tif (minColumn < ret.endColumn) {\n\t\t\t\tret = new Range(ret.startLineNumber, minColumn, ret.endLineNumber, ret.endColumn);\n\t\t\t\trawMarker.startColumn = minColumn;\n\t\t\t}\n\t\t}\n\t\treturn ret;\n\t}\n\n\tprivate _createDecorationOption(marker: IMarker): IModelDecorationOptions {\n\n\t\tlet className: string | undefined;\n\t\tlet color: ThemeColor | undefined = undefined;\n\t\tlet zIndex: number;\n\t\tlet inlineClassName: string | undefined = undefined;\n\t\tlet minimap: IModelDecorationMinimapOptions | undefined;\n\n\t\tswitch (marker.severity) {\n\t\t\tcase MarkerSeverity.Hint:\n\t\t\t\tif (this._hasMarkerTag(marker, MarkerTag.Deprecated)) {\n\t\t\t\t\tclassName = undefined;\n\t\t\t\t} else if (this._hasMarkerTag(marker, MarkerTag.Unnecessary)) {\n\t\t\t\t\tclassName = ClassName.EditorUnnecessaryDecoration;\n\t\t\t\t} else {\n\t\t\t\t\tclassName = ClassName.EditorHintDecoration;\n\t\t\t\t}\n\t\t\t\tzIndex = 0;\n\t\t\t\tbreak;\n\t\t\tcase MarkerSeverity.Info:\n\t\t\t\tclassName = ClassName.EditorInfoDecoration;\n\t\t\t\tcolor = themeColorFromId(overviewRulerInfo);\n\t\t\t\tzIndex = 10;\n\t\t\t\tminimap = {\n\t\t\t\t\tcolor: themeColorFromId(minimapInfo),\n\t\t\t\t\tposition: MinimapPosition.Inline\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase MarkerSeverity.Warning:\n\t\t\t\tclassName = ClassName.EditorWarningDecoration;\n\t\t\t\tcolor = themeColorFromId(overviewRulerWarning);\n\t\t\t\tzIndex = 20;\n\t\t\t\tminimap = {\n\t\t\t\t\tcolor: themeColorFromId(minimapWarning),\n\t\t\t\t\tposition: MinimapPosition.Inline\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase MarkerSeverity.Error:\n\t\t\tdefault:\n\t\t\t\tclassName = ClassName.EditorErrorDecoration;\n\t\t\t\tcolor = themeColorFromId(overviewRulerError);\n\t\t\t\tzIndex = 30;\n\t\t\t\tminimap = {\n\t\t\t\t\tcolor: themeColorFromId(minimapError),\n\t\t\t\t\tposition: MinimapPosition.Inline\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (marker.tags) {\n\t\t\tif (marker.tags.indexOf(MarkerTag.Unnecessary) !== -1) {\n\t\t\t\tinlineClassName = ClassName.EditorUnnecessaryInlineDecoration;\n\t\t\t}\n\t\t\tif (marker.tags.indexOf(MarkerTag.Deprecated) !== -1) {\n\t\t\t\tinlineClassName = ClassName.EditorDeprecatedInlineDecoration;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tdescription: 'marker-decoration',\n\t\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\t\tclassName,\n\t\t\tshowIfCollapsed: true,\n\t\t\toverviewRuler: {\n\t\t\t\tcolor,\n\t\t\t\tposition: OverviewRulerLane.Right\n\t\t\t},\n\t\t\tminimap,\n\t\t\tzIndex,\n\t\t\tinlineClassName,\n\t\t};\n\t}\n\n\tprivate _hasMarkerTag(marker: IMarker, tag: MarkerTag): boolean {\n\t\tif (marker.tags) {\n\t\t\treturn marker.tags.indexOf(tag) >= 0;\n\t\t}\n\t\treturn false;\n\t}\n}\n"]}