{"version":3,"sources":["file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src/vs/editor/contrib/middleScroll/browser/middleScrollController.ts","vs/editor/contrib/middleScroll/browser/middleScrollController.ts"],"names":[],"mappings":"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","file":"middleScrollController.js","sourceRoot":"file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { getWindow, addDisposableListener, n } from '../../../../base/browser/dom.js';\nimport { Disposable, DisposableStore, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { ICodeEditor } from '../../../browser/editorBrowser.js';\nimport { IEditorContribution, INewScrollPosition } from '../../../common/editorCommon.js';\nimport { EditorOption } from '../../../common/config/editorOptions.js';\nimport { autorun, derived, disposableObservableValue, IObservable, observableValue } from '../../../../base/common/observable.js';\nimport { observableCodeEditor } from '../../../browser/observableCodeEditor.js';\nimport { Point } from '../../../common/core/2d/point.js';\nimport { AnimationFrameScheduler } from '../../inlineCompletions/browser/model/animation.js';\nimport { appendRemoveOnDispose } from '../../../browser/widget/diffEditor/utils.js';\nimport './middleScroll.css';\n\nexport class MiddleScrollController extends Disposable implements IEditorContribution {\n\tpublic static readonly ID = 'editor.contrib.middleScroll';\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor\n\t) {\n\t\tsuper();\n\n\t\tconst obsEditor = observableCodeEditor(this._editor);\n\t\tconst scrollOnMiddleClick = obsEditor.getOption(EditorOption.scrollOnMiddleClick);\n\n\t\tthis._register(autorun(reader => {\n\t\t\tif (!scrollOnMiddleClick.read(reader)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst editorDomNode = obsEditor.domNode.read(reader);\n\t\t\tif (!editorDomNode) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst scrollingSession = reader.store.add(\n\t\t\t\tdisposableObservableValue(\n\t\t\t\t\t'scrollingSession',\n\t\t\t\t\tundefined as undefined | { mouseDeltaAfterThreshold: IObservable<Point>; initialMousePosInEditor: Point; didScroll: boolean } & IDisposable\n\t\t\t\t)\n\t\t\t);\n\n\t\t\treader.store.add(this._editor.onMouseDown(e => {\n\t\t\t\tconst session = scrollingSession.get();\n\t\t\t\tif (session) {\n\t\t\t\t\tscrollingSession.set(undefined, undefined);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!e.event.middleButton) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\te.event.stopPropagation();\n\t\t\t\te.event.preventDefault();\n\n\t\t\t\tconst store = new DisposableStore();\n\t\t\t\tconst initialPos = new Point(e.event.posx, e.event.posy);\n\t\t\t\tconst mousePos = observeWindowMousePos(getWindow(editorDomNode), initialPos, store);\n\t\t\t\tconst mouseDeltaAfterThreshold = mousePos.map(v => v.subtract(initialPos).withThreshold(5));\n\n\t\t\t\tconst editorDomNodeRect = editorDomNode.getBoundingClientRect();\n\t\t\t\tconst initialMousePosInEditor = new Point(initialPos.x - editorDomNodeRect.left, initialPos.y - editorDomNodeRect.top);\n\n\t\t\t\tscrollingSession.set({\n\t\t\t\t\tmouseDeltaAfterThreshold,\n\t\t\t\t\tinitialMousePosInEditor,\n\t\t\t\t\tdidScroll: false,\n\t\t\t\t\tdispose: () => store.dispose(),\n\t\t\t\t}, undefined);\n\n\t\t\t\tstore.add(this._editor.onMouseUp(e => {\n\t\t\t\t\tconst session = scrollingSession.get();\n\t\t\t\t\tif (session && session.didScroll) {\n\t\t\t\t\t\t// Only cancel session on release if the user scrolled during it\n\t\t\t\t\t\tscrollingSession.set(undefined, undefined);\n\t\t\t\t\t}\n\t\t\t\t}));\n\n\t\t\t\tstore.add(this._editor.onKeyDown(e => {\n\t\t\t\t\tscrollingSession.set(undefined, undefined);\n\t\t\t\t}));\n\t\t\t}));\n\n\t\t\treader.store.add(autorun(reader => {\n\t\t\t\tconst session = scrollingSession.read(reader);\n\t\t\t\tif (!session) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet lastTime = Date.now();\n\t\t\t\treader.store.add(autorun(reader => {\n\t\t\t\t\tAnimationFrameScheduler.instance.invalidateOnNextAnimationFrame(reader);\n\n\t\t\t\t\tconst curTime = Date.now();\n\t\t\t\t\tconst frameDurationMs = curTime - lastTime;\n\t\t\t\t\tlastTime = curTime;\n\n\t\t\t\t\tconst mouseDelta = session.mouseDeltaAfterThreshold.get();\n\n\t\t\t\t\t// scroll by mouse delta every 32ms\n\t\t\t\t\tconst factor = frameDurationMs / 32;\n\t\t\t\t\tconst scrollDelta = mouseDelta.scale(factor);\n\n\t\t\t\t\tconst scrollPos = new Point(this._editor.getScrollLeft(), this._editor.getScrollTop());\n\t\t\t\t\tthis._editor.setScrollPosition(toScrollPosition(scrollPos.add(scrollDelta)));\n\t\t\t\t\tif (!scrollDelta.isZero()) {\n\t\t\t\t\t\tsession.didScroll = true;\n\t\t\t\t\t}\n\t\t\t\t}));\n\n\t\t\t\tconst directionAttr = derived(reader => {\n\t\t\t\t\tconst delta = session.mouseDeltaAfterThreshold.read(reader);\n\t\t\t\t\tlet direction: string = '';\n\t\t\t\t\tdirection += (delta.y < 0 ? 'n' : (delta.y > 0 ? 's' : ''));\n\t\t\t\t\tdirection += (delta.x < 0 ? 'w' : (delta.x > 0 ? 'e' : ''));\n\t\t\t\t\treturn direction;\n\t\t\t\t});\n\t\t\t\treader.store.add(autorun(reader => {\n\t\t\t\t\teditorDomNode.setAttribute('data-scroll-direction', directionAttr.read(reader));\n\t\t\t\t}));\n\t\t\t}));\n\n\t\t\tconst dotDomElem = reader.store.add(n.div({\n\t\t\t\tclass: ['scroll-editor-on-middle-click-dot', scrollingSession.map(session => session ? '' : 'hidden')],\n\t\t\t\tstyle: {\n\t\t\t\t\tleft: scrollingSession.map((session) => session ? session.initialMousePosInEditor.x : 0),\n\t\t\t\t\ttop: scrollingSession.map((session) => session ? session.initialMousePosInEditor.y : 0),\n\t\t\t\t}\n\t\t\t}).toDisposableLiveElement());\n\t\t\treader.store.add(appendRemoveOnDispose(editorDomNode, dotDomElem.element));\n\n\t\t\treader.store.add(autorun(reader => {\n\t\t\t\tconst session = scrollingSession.read(reader);\n\t\t\t\teditorDomNode.classList.toggle('scroll-editor-on-middle-click-editor', !!session);\n\t\t\t}));\n\t\t}));\n\t}\n}\n\nfunction observeWindowMousePos(window: Window, initialPos: Point, store: DisposableStore): IObservable<Point> {\n\tconst val = observableValue('pos', initialPos);\n\tstore.add(addDisposableListener(window, 'mousemove', (e: MouseEvent) => {\n\t\tval.set(new Point(e.pageX, e.pageY), undefined);\n\t}));\n\treturn val;\n}\n\nfunction toScrollPosition(p: Point): INewScrollPosition {\n\treturn {\n\t\tscrollLeft: p.x,\n\t\tscrollTop: p.y,\n\t};\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { getWindow, addDisposableListener, n } from '../../../../base/browser/dom.js';\nimport { Disposable, DisposableStore, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { ICodeEditor } from '../../../browser/editorBrowser.js';\nimport { IEditorContribution, INewScrollPosition } from '../../../common/editorCommon.js';\nimport { EditorOption } from '../../../common/config/editorOptions.js';\nimport { autorun, derived, disposableObservableValue, IObservable, observableValue } from '../../../../base/common/observable.js';\nimport { observableCodeEditor } from '../../../browser/observableCodeEditor.js';\nimport { Point } from '../../../common/core/2d/point.js';\nimport { AnimationFrameScheduler } from '../../inlineCompletions/browser/model/animation.js';\nimport { appendRemoveOnDispose } from '../../../browser/widget/diffEditor/utils.js';\nimport './middleScroll.css';\n\nexport class MiddleScrollController extends Disposable implements IEditorContribution {\n\tpublic static readonly ID = 'editor.contrib.middleScroll';\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor\n\t) {\n\t\tsuper();\n\n\t\tconst obsEditor = observableCodeEditor(this._editor);\n\t\tconst scrollOnMiddleClick = obsEditor.getOption(EditorOption.scrollOnMiddleClick);\n\n\t\tthis._register(autorun(reader => {\n\t\t\tif (!scrollOnMiddleClick.read(reader)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst editorDomNode = obsEditor.domNode.read(reader);\n\t\t\tif (!editorDomNode) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst scrollingSession = reader.store.add(\n\t\t\t\tdisposableObservableValue(\n\t\t\t\t\t'scrollingSession',\n\t\t\t\t\tundefined as undefined | { mouseDeltaAfterThreshold: IObservable<Point>; initialMousePosInEditor: Point; didScroll: boolean } & IDisposable\n\t\t\t\t)\n\t\t\t);\n\n\t\t\treader.store.add(this._editor.onMouseDown(e => {\n\t\t\t\tconst session = scrollingSession.get();\n\t\t\t\tif (session) {\n\t\t\t\t\tscrollingSession.set(undefined, undefined);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!e.event.middleButton) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\te.event.stopPropagation();\n\t\t\t\te.event.preventDefault();\n\n\t\t\t\tconst store = new DisposableStore();\n\t\t\t\tconst initialPos = new Point(e.event.posx, e.event.posy);\n\t\t\t\tconst mousePos = observeWindowMousePos(getWindow(editorDomNode), initialPos, store);\n\t\t\t\tconst mouseDeltaAfterThreshold = mousePos.map(v => v.subtract(initialPos).withThreshold(5));\n\n\t\t\t\tconst editorDomNodeRect = editorDomNode.getBoundingClientRect();\n\t\t\t\tconst initialMousePosInEditor = new Point(initialPos.x - editorDomNodeRect.left, initialPos.y - editorDomNodeRect.top);\n\n\t\t\t\tscrollingSession.set({\n\t\t\t\t\tmouseDeltaAfterThreshold,\n\t\t\t\t\tinitialMousePosInEditor,\n\t\t\t\t\tdidScroll: false,\n\t\t\t\t\tdispose: () => store.dispose(),\n\t\t\t\t}, undefined);\n\n\t\t\t\tstore.add(this._editor.onMouseUp(e => {\n\t\t\t\t\tconst session = scrollingSession.get();\n\t\t\t\t\tif (session && session.didScroll) {\n\t\t\t\t\t\t// Only cancel session on release if the user scrolled during it\n\t\t\t\t\t\tscrollingSession.set(undefined, undefined);\n\t\t\t\t\t}\n\t\t\t\t}));\n\n\t\t\t\tstore.add(this._editor.onKeyDown(e => {\n\t\t\t\t\tscrollingSession.set(undefined, undefined);\n\t\t\t\t}));\n\t\t\t}));\n\n\t\t\treader.store.add(autorun(reader => {\n\t\t\t\tconst session = scrollingSession.read(reader);\n\t\t\t\tif (!session) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet lastTime = Date.now();\n\t\t\t\treader.store.add(autorun(reader => {\n\t\t\t\t\tAnimationFrameScheduler.instance.invalidateOnNextAnimationFrame(reader);\n\n\t\t\t\t\tconst curTime = Date.now();\n\t\t\t\t\tconst frameDurationMs = curTime - lastTime;\n\t\t\t\t\tlastTime = curTime;\n\n\t\t\t\t\tconst mouseDelta = session.mouseDeltaAfterThreshold.get();\n\n\t\t\t\t\t// scroll by mouse delta every 32ms\n\t\t\t\t\tconst factor = frameDurationMs / 32;\n\t\t\t\t\tconst scrollDelta = mouseDelta.scale(factor);\n\n\t\t\t\t\tconst scrollPos = new Point(this._editor.getScrollLeft(), this._editor.getScrollTop());\n\t\t\t\t\tthis._editor.setScrollPosition(toScrollPosition(scrollPos.add(scrollDelta)));\n\t\t\t\t\tif (!scrollDelta.isZero()) {\n\t\t\t\t\t\tsession.didScroll = true;\n\t\t\t\t\t}\n\t\t\t\t}));\n\n\t\t\t\tconst directionAttr = derived(reader => {\n\t\t\t\t\tconst delta = session.mouseDeltaAfterThreshold.read(reader);\n\t\t\t\t\tlet direction: string = '';\n\t\t\t\t\tdirection += (delta.y < 0 ? 'n' : (delta.y > 0 ? 's' : ''));\n\t\t\t\t\tdirection += (delta.x < 0 ? 'w' : (delta.x > 0 ? 'e' : ''));\n\t\t\t\t\treturn direction;\n\t\t\t\t});\n\t\t\t\treader.store.add(autorun(reader => {\n\t\t\t\t\teditorDomNode.setAttribute('data-scroll-direction', directionAttr.read(reader));\n\t\t\t\t}));\n\t\t\t}));\n\n\t\t\tconst dotDomElem = reader.store.add(n.div({\n\t\t\t\tclass: ['scroll-editor-on-middle-click-dot', scrollingSession.map(session => session ? '' : 'hidden')],\n\t\t\t\tstyle: {\n\t\t\t\t\tleft: scrollingSession.map((session) => session ? session.initialMousePosInEditor.x : 0),\n\t\t\t\t\ttop: scrollingSession.map((session) => session ? session.initialMousePosInEditor.y : 0),\n\t\t\t\t}\n\t\t\t}).toDisposableLiveElement());\n\t\t\treader.store.add(appendRemoveOnDispose(editorDomNode, dotDomElem.element));\n\n\t\t\treader.store.add(autorun(reader => {\n\t\t\t\tconst session = scrollingSession.read(reader);\n\t\t\t\teditorDomNode.classList.toggle('scroll-editor-on-middle-click-editor', !!session);\n\t\t\t}));\n\t\t}));\n\t}\n}\n\nfunction observeWindowMousePos(window: Window, initialPos: Point, store: DisposableStore): IObservable<Point> {\n\tconst val = observableValue('pos', initialPos);\n\tstore.add(addDisposableListener(window, 'mousemove', (e: MouseEvent) => {\n\t\tval.set(new Point(e.pageX, e.pageY), undefined);\n\t}));\n\treturn val;\n}\n\nfunction toScrollPosition(p: Point): INewScrollPosition {\n\treturn {\n\t\tscrollLeft: p.x,\n\t\tscrollTop: p.y,\n\t};\n}\n"]}