{"version":3,"sources":["vs/editor/browser/controller/editContext/native/screenReaderSupport.ts"],"names":[],"mappings":"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","file":"screenReaderSupport.js","sourceRoot":"file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { FastDomNode } from '../../../../../base/browser/fastDomNode.js';\nimport { Disposable, MutableDisposable } from '../../../../../base/common/lifecycle.js';\nimport { localize } from '../../../../../nls.js';\nimport { IAccessibilityService } from '../../../../../platform/accessibility/common/accessibility.js';\nimport { IKeybindingService } from '../../../../../platform/keybinding/common/keybinding.js';\nimport { EditorOption } from '../../../../common/config/editorOptions.js';\nimport { FontInfo } from '../../../../common/config/fontInfo.js';\nimport { Selection } from '../../../../common/core/selection.js';\nimport { ViewConfigurationChangedEvent, ViewCursorStateChangedEvent } from '../../../../common/viewEvents.js';\nimport { ViewContext } from '../../../../common/viewModel/viewContext.js';\nimport { applyFontInfo } from '../../../config/domFontInfo.js';\nimport { IEditorAriaOptions } from '../../../editorBrowser.js';\nimport { RestrictedRenderingContext, RenderingContext, HorizontalPosition } from '../../../view/renderingContext.js';\nimport { ViewController } from '../../../view/viewController.js';\nimport { ariaLabelForScreenReaderContent } from '../screenReaderUtils.js';\nimport { RichScreenReaderContent } from './screenReaderContentRich.js';\nimport { SimpleScreenReaderContent } from './screenReaderContentSimple.js';\nimport { IScreenReaderContent } from './screenReaderUtils.js';\n\nexport class ScreenReaderSupport extends Disposable {\n\n\t// Configuration values\n\tprivate _contentLeft: number = 1;\n\tprivate _contentWidth: number = 1;\n\tprivate _contentHeight: number = 1;\n\tprivate _divWidth: number = 1;\n\tprivate _fontInfo!: FontInfo;\n\tprivate _renderRichContent: boolean | undefined;\n\n\tprivate _primarySelection: Selection = new Selection(1, 1, 1, 1);\n\tprivate _primaryCursorVisibleRange: HorizontalPosition | null = null;\n\tprivate readonly _state: MutableDisposable<IScreenReaderContent>;\n\n\tconstructor(\n\t\tprivate readonly _domNode: FastDomNode<HTMLElement>,\n\t\tprivate readonly _context: ViewContext,\n\t\tprivate readonly _viewController: ViewController,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService,\n\t\t@IAccessibilityService private readonly _accessibilityService: IAccessibilityService\n\t) {\n\t\tsuper();\n\t\tthis._state = this._register(new MutableDisposable<IScreenReaderContent>());\n\t\tthis._instantiateScreenReaderContent();\n\t\tthis._updateConfigurationSettings();\n\t\tthis._updateDomAttributes();\n\t}\n\n\tpublic onWillPaste(): void {\n\t\tthis._state.value?.onWillPaste();\n\t}\n\n\tpublic onWillCut(): void {\n\t\tthis._state.value?.onWillCut();\n\t}\n\n\tpublic handleFocusChange(newFocusValue: boolean): void {\n\t\tthis._state.value?.onFocusChange(newFocusValue);\n\t\tthis.writeScreenReaderContent();\n\t}\n\n\tpublic onConfigurationChanged(e: ViewConfigurationChangedEvent): void {\n\t\tthis._instantiateScreenReaderContent();\n\t\tthis._updateConfigurationSettings();\n\t\tthis._updateDomAttributes();\n\t\tif (e.hasChanged(EditorOption.accessibilitySupport)) {\n\t\t\tthis.writeScreenReaderContent();\n\t\t}\n\t}\n\n\tprivate _instantiateScreenReaderContent(): void {\n\t\tconst renderRichContent = this._context.configuration.options.get(EditorOption.renderRichScreenReaderContent);\n\t\tif (this._renderRichContent !== renderRichContent) {\n\t\t\tthis._renderRichContent = renderRichContent;\n\t\t\tthis._state.value = this._createScreenReaderContent(renderRichContent);\n\t\t}\n\t}\n\n\tprivate _createScreenReaderContent(renderRichContent: boolean): IScreenReaderContent {\n\t\tif (renderRichContent) {\n\t\t\treturn new RichScreenReaderContent(this._domNode, this._context, this._viewController, this._accessibilityService);\n\t\t} else {\n\t\t\treturn new SimpleScreenReaderContent(this._domNode, this._context, this._viewController, this._accessibilityService);\n\t\t}\n\t}\n\n\tprivate _updateConfigurationSettings(): void {\n\t\tconst options = this._context.configuration.options;\n\t\tconst layoutInfo = options.get(EditorOption.layoutInfo);\n\t\tconst wrappingColumn = layoutInfo.wrappingColumn;\n\t\tthis._contentLeft = layoutInfo.contentLeft;\n\t\tthis._contentWidth = layoutInfo.contentWidth;\n\t\tthis._contentHeight = layoutInfo.height;\n\t\tthis._fontInfo = options.get(EditorOption.fontInfo);\n\t\tthis._divWidth = Math.round(wrappingColumn * this._fontInfo.typicalHalfwidthCharacterWidth);\n\t\tthis._state.value?.onConfigurationChanged(options);\n\t}\n\n\tprivate _updateDomAttributes(): void {\n\t\tconst options = this._context.configuration.options;\n\t\tthis._domNode.domNode.setAttribute('role', 'textbox');\n\t\tthis._domNode.domNode.setAttribute('aria-required', options.get(EditorOption.ariaRequired) ? 'true' : 'false');\n\t\tthis._domNode.domNode.setAttribute('aria-multiline', 'true');\n\t\tthis._domNode.domNode.setAttribute('aria-autocomplete', options.get(EditorOption.readOnly) ? 'none' : 'both');\n\t\tthis._domNode.domNode.setAttribute('aria-roledescription', localize('editor', \"editor\"));\n\t\tthis._domNode.domNode.setAttribute('aria-label', ariaLabelForScreenReaderContent(options, this._keybindingService));\n\t\tconst tabSize = this._context.viewModel.model.getOptions().tabSize;\n\t\tconst spaceWidth = options.get(EditorOption.fontInfo).spaceWidth;\n\t\tthis._domNode.domNode.style.tabSize = `${tabSize * spaceWidth}px`;\n\t\tconst wordWrapOverride2 = options.get(EditorOption.wordWrapOverride2);\n\t\tconst wordWrapOverride1 = (wordWrapOverride2 === 'inherit' ? options.get(EditorOption.wordWrapOverride1) : wordWrapOverride2);\n\t\tconst wordWrap = (wordWrapOverride1 === 'inherit' ? options.get(EditorOption.wordWrap) : wordWrapOverride1);\n\t\tthis._domNode.domNode.style.textWrap = wordWrap === 'off' ? 'nowrap' : 'wrap';\n\t}\n\n\tpublic onCursorStateChanged(e: ViewCursorStateChangedEvent): void {\n\t\tthis._primarySelection = e.selections[0] ?? new Selection(1, 1, 1, 1);\n\t}\n\n\tpublic prepareRender(ctx: RenderingContext): void {\n\t\tthis.writeScreenReaderContent();\n\t\tthis._primaryCursorVisibleRange = ctx.visibleRangeForPosition(this._primarySelection.getPosition());\n\t}\n\n\tpublic render(ctx: RestrictedRenderingContext): void {\n\t\tif (!this._primaryCursorVisibleRange) {\n\t\t\t// The primary cursor is outside the viewport => place textarea to the top left\n\t\t\tthis._renderAtTopLeft();\n\t\t\treturn;\n\t\t}\n\n\t\tconst editorScrollLeft = this._context.viewLayout.getCurrentScrollLeft();\n\t\tconst left = this._contentLeft + this._primaryCursorVisibleRange.left - editorScrollLeft;\n\t\tif (left < this._contentLeft || left > this._contentLeft + this._contentWidth) {\n\t\t\t// cursor is outside the viewport\n\t\t\tthis._renderAtTopLeft();\n\t\t\treturn;\n\t\t}\n\n\t\tconst editorScrollTop = this._context.viewLayout.getCurrentScrollTop();\n\t\tconst positionLineNumber = this._primarySelection.positionLineNumber;\n\t\tconst top = this._context.viewLayout.getVerticalOffsetForLineNumber(positionLineNumber) - editorScrollTop;\n\t\tif (top < 0 || top > this._contentHeight) {\n\t\t\t// cursor is outside the viewport\n\t\t\tthis._renderAtTopLeft();\n\t\t\treturn;\n\t\t}\n\n\t\t// The <div> where we render the screen reader content does not support variable line heights,\n\t\t// all the lines must have the same height. We use the line height of the cursor position as the\n\t\t// line height for all lines.\n\t\tconst lineHeight = this._context.viewLayout.getLineHeightForLineNumber(positionLineNumber);\n\t\tthis._doRender(top, this._contentLeft, this._divWidth, lineHeight);\n\t\tthis._state.value?.updateScrollTop(this._primarySelection);\n\t}\n\n\tprivate _renderAtTopLeft(): void {\n\t\tthis._doRender(0, 0, this._contentWidth, 1);\n\t}\n\n\tprivate _doRender(top: number, left: number, width: number, height: number): void {\n\t\t// For correct alignment of the screen reader content, we need to apply the correct font\n\t\tapplyFontInfo(this._domNode, this._fontInfo);\n\n\t\tthis._domNode.setTop(top);\n\t\tthis._domNode.setLeft(left);\n\t\tthis._domNode.setWidth(width);\n\t\tthis._domNode.setHeight(height);\n\t\tthis._domNode.setLineHeight(height);\n\t}\n\n\tpublic setAriaOptions(options: IEditorAriaOptions): void {\n\t\tif (options.activeDescendant) {\n\t\t\tthis._domNode.setAttribute('aria-haspopup', 'true');\n\t\t\tthis._domNode.setAttribute('aria-autocomplete', 'list');\n\t\t\tthis._domNode.setAttribute('aria-activedescendant', options.activeDescendant);\n\t\t} else {\n\t\t\tthis._domNode.setAttribute('aria-haspopup', 'false');\n\t\t\tthis._domNode.setAttribute('aria-autocomplete', 'both');\n\t\t\tthis._domNode.removeAttribute('aria-activedescendant');\n\t\t}\n\t\tif (options.role) {\n\t\t\tthis._domNode.setAttribute('role', options.role);\n\t\t}\n\t}\n\n\tpublic writeScreenReaderContent(): void {\n\t\tthis._state.value?.updateScreenReaderContent(this._primarySelection);\n\t}\n}\n"]}