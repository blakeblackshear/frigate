{"version":3,"sources":["vs/editor/contrib/linkedEditing/browser/linkedEditing.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;AAEhG,OAAO,KAAK,MAAM,MAAM,mCAAmC,CAAC;AAC5D,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,MAAM,kCAAkC,CAAC;AAClE,OAAO,EAAE,iBAAiB,EAAE,uBAAuB,EAAE,MAAM,yCAAyC,CAAC;AACrG,OAAO,EAAE,KAAK,EAAE,MAAM,kCAAkC,CAAC;AACzD,OAAO,EAAE,mBAAmB,EAAE,iBAAiB,EAAE,yBAAyB,EAAE,MAAM,mCAAmC,CAAC;AACtH,OAAO,EAAE,KAAK,EAAE,MAAM,kCAAkC,CAAC;AAEzD,OAAO,EAAE,UAAU,EAAE,eAAe,EAAE,MAAM,sCAAsC,CAAC;AACnF,OAAO,KAAK,OAAO,MAAM,oCAAoC,CAAC;AAC9D,OAAO,EAAE,GAAG,EAAE,MAAM,gCAAgC,CAAC;AAErD,OAAO,EAAE,YAAY,EAAE,aAAa,EAAmC,oBAAoB,EAAE,qBAAqB,EAAE,0BAA0B,EAAE,+BAA+B,EAAoB,MAAM,sCAAsC,CAAC;AAChP,OAAO,EAAE,kBAAkB,EAAE,MAAM,gDAAgD,CAAC;AAEpF,OAAO,EAAa,QAAQ,EAAE,MAAM,kCAAkC,CAAC;AACvE,OAAO,EAAU,KAAK,EAAE,MAAM,+BAA+B,CAAC;AAE9D,OAAO,EAAE,iBAAiB,EAAE,MAAM,sCAAsC,CAAC;AAEzE,OAAO,EAAE,sBAAsB,EAAE,MAAM,oCAAoC,CAAC;AAE5E,OAAO,EAAE,6BAA6B,EAAE,MAAM,4DAA4D,CAAC;AAC3G,OAAO,KAAK,GAAG,MAAM,oBAAoB,CAAC;AAC1C,OAAO,EAAE,cAAc,EAAe,kBAAkB,EAAE,aAAa,EAAE,MAAM,sDAAsD,CAAC;AAEtI,OAAO,EAAE,wBAAwB,EAAE,MAAM,8CAA8C,CAAC;AACxF,OAAO,EAAE,aAAa,EAAE,MAAM,oDAAoD,CAAC;AAGnF,OAAO,EAA+B,+BAA+B,EAAE,MAAM,qDAAqD,CAAC;AACnI,OAAO,EAAE,SAAS,EAAE,MAAM,sCAAsC,CAAC;AACjE,OAAO,qBAAqB,CAAC;AAE7B,MAAM,CAAC,MAAM,mCAAmC,GAAG,IAAI,aAAa,CAAU,2BAA2B,EAAE,KAAK,CAAC,CAAC;AAElH,MAAM,qBAAqB,GAAG,2BAA2B,CAAC;AAEnD,IAAM,yBAAyB,GAA/B,MAAM,yBAA0B,SAAQ,UAAU;;aAEjC,OAAE,GAAG,8BAAH,AAAiC,CAAC;aAEnC,eAAU,GAAG,sBAAsB,CAAC,QAAQ,CAAC;QACpE,WAAW,EAAE,gBAAgB;QAC7B,UAAU,6DAAqD;QAC/D,SAAS,EAAE,qBAAqB;KAChC,CAJiC,AAIhC,CAAC;IAEH,MAAM,CAAC,GAAG,CAAC,MAAmB;QAC7B,OAAO,MAAM,CAAC,eAAe,CAA4B,2BAAyB,CAAC,EAAE,CAAC,CAAC;IACxF,CAAC;IA2BD,YACC,MAAmB,EACC,iBAAqC,EAC/B,uBAAiD,EAC5C,4BAA4E,EAC1E,8BAA+D;QAEhG,KAAK,EAAE,CAAC;QAHwC,iCAA4B,GAA5B,4BAA4B,CAA+B;QAZpG,qBAAgB,GAAW,CAAC,CAAC;QAMpB,oBAAe,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,eAAe,EAAE,CAAC,CAAC;QAUxE,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;QACtB,IAAI,CAAC,UAAU,GAAG,uBAAuB,CAAC,0BAA0B,CAAC;QACrE,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QACtB,IAAI,CAAC,kBAAkB,GAAG,mCAAmC,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;QACxF,IAAI,CAAC,oBAAoB,GAAG,8BAA8B,CAAC,GAAG,CAAC,IAAI,CAAC,UAAU,EAAE,gBAAgB,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC;QAEhH,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC,OAAO,CAAC,2BAA2B,EAAE,CAAC;QACtE,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC;QACjC,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC;QAChC,IAAI,CAAC,kBAAkB,GAAG,KAAK,CAAC;QAChC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,eAAe,EAAE,CAAC,CAAC;QAE7D,IAAI,CAAC,0BAA0B,GAAG,IAAI,CAAC;QACvC,IAAI,CAAC,wBAAwB,GAAG,IAAI,CAAC;QAErC,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC;QAC/B,IAAI,CAAC,uBAAuB,GAAG,IAAI,CAAC;QACpC,IAAI,CAAC,2BAA2B,GAAG,IAAI,CAAC;QAExC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAE7E,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,wBAAwB,CAAC,CAAC,CAAC,EAAE;YACxD,IAAI,CAAC,CAAC,UAAU,qCAA4B,IAAI,CAAC,CAAC,UAAU,qCAA2B,EAAE,CAAC;gBACzF,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;YAC1B,CAAC;QACF,CAAC,CAAC,CAAC,CAAC;QACJ,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAC5E,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,wBAAwB,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAErF,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;IACzB,CAAC;IAEO,YAAY,CAAC,YAAqB;QACzC,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;QACtC,MAAM,SAAS,GAAG,KAAK,KAAK,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,qCAA4B,IAAI,IAAI,CAAC,OAAO,CAAC,SAAS,qCAA2B,CAAC,IAAI,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QAC5K,IAAI,SAAS,KAAK,IAAI,CAAC,QAAQ,IAAI,CAAC,YAAY,EAAE,CAAC;YAClD,OAAO;QACR,CAAC;QAED,IAAI,CAAC,QAAQ,GAAG,SAAS,CAAC;QAE1B,IAAI,CAAC,WAAW,EAAE,CAAC;QACnB,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE,CAAC;QAE7B,IAAI,CAAC,SAAS,IAAI,KAAK,KAAK,IAAI,EAAE,CAAC;YAClC,OAAO;QACR,CAAC;QAED,IAAI,CAAC,eAAe,CAAC,GAAG,CACvB,KAAK,CAAC,eAAe,CACpB,KAAK,CAAC,gCAAgC,EACtC,GAAG,EAAE;YACJ,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC,4BAA4B,CAAC,wBAAwB,CAAC,KAAK,CAAC,aAAa,EAAE,CAAC,CAAC,iBAAiB,EAAE,CAAC;QACnI,CAAC,CACD,CACD,CAAC;QAEF,MAAM,oBAAoB,GAAG,IAAI,OAAO,CAAC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC;QAC/E,MAAM,kBAAkB,GAAG,GAAG,EAAE;YAC/B,IAAI,CAAC,0BAA0B,GAAG,oBAAoB,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,EAAE,EAAE,IAAI,CAAC,iBAAiB,IAAI,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC;QAC3J,CAAC,CAAC;QACF,MAAM,kBAAkB,GAAG,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC;QAC1C,MAAM,gBAAgB,GAAG,CAAC,KAAa,EAAE,EAAE;YAC1C,IAAI,CAAC,wBAAwB,GAAG,kBAAkB,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,CAAC;QAC3F,CAAC,CAAC;QACF,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,yBAAyB,CAAC,GAAG,EAAE;YACpE,kBAAkB,EAAE,CAAC;QACtB,CAAC,CAAC,CAAC,CAAC;QACJ,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,uBAAuB,CAAC,CAAC,CAAC,EAAE,EAAE;YACnE,IAAI,CAAC,IAAI,CAAC,kBAAkB,EAAE,CAAC;gBAC9B,IAAI,IAAI,CAAC,mBAAmB,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;oBACzC,MAAM,cAAc,GAAG,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;oBAC5D,IAAI,cAAc,IAAI,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC;wBACrF,gBAAgB,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;wBACxC,OAAO;oBACR,CAAC;gBACF,CAAC;YACF,CAAC;YACD,kBAAkB,EAAE,CAAC;QACtB,CAAC,CAAC,CAAC,CAAC;QACJ,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC;YACxB,OAAO,EAAE,GAAG,EAAE;gBACb,oBAAoB,CAAC,OAAO,EAAE,CAAC;gBAC/B,kBAAkB,CAAC,OAAO,EAAE,CAAC;YAC9B,CAAC;SACD,CAAC,CAAC;QACH,IAAI,CAAC,YAAY,EAAE,CAAC;IACrB,CAAC;IAEO,WAAW,CAAC,KAAa;QAChC,+CAA+C;QAC/C,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,IAAI,KAAK,KAAK,IAAI,CAAC,gBAAgB,IAAI,IAAI,CAAC,mBAAmB,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YAC1G,gBAAgB;YAChB,OAAO;QACR,CAAC;QAED,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;QACtC,MAAM,cAAc,GAAG,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;QAE5D,IAAI,CAAC,cAAc,IAAI,cAAc,CAAC,eAAe,KAAK,cAAc,CAAC,aAAa,EAAE,CAAC;YACxF,OAAO,IAAI,CAAC,WAAW,EAAE,CAAC;QAC3B,CAAC;QAED,MAAM,cAAc,GAAG,KAAK,CAAC,eAAe,CAAC,cAAc,CAAC,CAAC;QAC7D,IAAI,IAAI,CAAC,mBAAmB,EAAE,CAAC;YAC9B,MAAM,KAAK,GAAG,cAAc,CAAC,KAAK,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;YAC7D,MAAM,WAAW,GAAG,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;YAChD,IAAI,WAAW,KAAK,cAAc,CAAC,MAAM,EAAE,CAAC;gBAC3C,OAAO,IAAI,CAAC,WAAW,EAAE,CAAC;YAC3B,CAAC;QACF,CAAC;QAED,MAAM,KAAK,GAA2B,EAAE,CAAC;QACzC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,GAAG,IAAI,CAAC,mBAAmB,CAAC,MAAM,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC;YACrE,MAAM,WAAW,GAAG,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;YACzD,IAAI,CAAC,WAAW,EAAE,CAAC;gBAClB,SAAS;YACV,CAAC;YACD,IAAI,WAAW,CAAC,eAAe,KAAK,WAAW,CAAC,aAAa,EAAE,CAAC;gBAC/D,KAAK,CAAC,IAAI,CAAC;oBACV,KAAK,EAAE,WAAW;oBAClB,IAAI,EAAE,cAAc;iBACpB,CAAC,CAAC;YACJ,CAAC;iBAAM,CAAC;gBACP,IAAI,QAAQ,GAAG,KAAK,CAAC,eAAe,CAAC,WAAW,CAAC,CAAC;gBAClD,IAAI,QAAQ,GAAG,cAAc,CAAC;gBAC9B,IAAI,gBAAgB,GAAG,WAAW,CAAC,WAAW,CAAC;gBAC/C,IAAI,cAAc,GAAG,WAAW,CAAC,SAAS,CAAC;gBAE3C,MAAM,kBAAkB,GAAG,OAAO,CAAC,kBAAkB,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;gBAC1E,gBAAgB,IAAI,kBAAkB,CAAC;gBACvC,QAAQ,GAAG,QAAQ,CAAC,MAAM,CAAC,kBAAkB,CAAC,CAAC;gBAC/C,QAAQ,GAAG,QAAQ,CAAC,MAAM,CAAC,kBAAkB,CAAC,CAAC;gBAE/C,MAAM,kBAAkB,GAAG,OAAO,CAAC,kBAAkB,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;gBAC1E,cAAc,IAAI,kBAAkB,CAAC;gBACrC,QAAQ,GAAG,QAAQ,CAAC,MAAM,CAAC,CAAC,EAAE,QAAQ,CAAC,MAAM,GAAG,kBAAkB,CAAC,CAAC;gBACpE,QAAQ,GAAG,QAAQ,CAAC,MAAM,CAAC,CAAC,EAAE,QAAQ,CAAC,MAAM,GAAG,kBAAkB,CAAC,CAAC;gBAEpE,IAAI,gBAAgB,KAAK,cAAc,IAAI,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;oBAClE,KAAK,CAAC,IAAI,CAAC;wBACV,KAAK,EAAE,IAAI,KAAK,CAAC,WAAW,CAAC,eAAe,EAAE,gBAAgB,EAAE,WAAW,CAAC,aAAa,EAAE,cAAc,CAAC;wBAC1G,IAAI,EAAE,QAAQ;qBACd,CAAC,CAAC;gBACJ,CAAC;YACF,CAAC;QACF,CAAC;QAED,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACxB,OAAO;QACR,CAAC;QAED,IAAI,CAAC;YACJ,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;YAC3B,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC;YAC/B,MAAM,qBAAqB,GAAG,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE,CAAC,wBAAwB,EAAE,CAAC;YACtF,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,eAAe,EAAE,KAAK,CAAC,CAAC;YAClD,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE,CAAC,wBAAwB,CAAC,qBAAqB,CAAC,CAAC;QAC9E,CAAC;gBAAS,CAAC;YACV,IAAI,CAAC,kBAAkB,GAAG,KAAK,CAAC;QACjC,CAAC;IACF,CAAC;IAEe,OAAO;QACtB,IAAI,CAAC,WAAW,EAAE,CAAC;QACnB,KAAK,CAAC,OAAO,EAAE,CAAC;IACjB,CAAC;IAEM,WAAW;QACjB,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACnC,IAAI,CAAC,mBAAmB,CAAC,KAAK,EAAE,CAAC;QACjC,IAAI,IAAI,CAAC,kBAAkB,EAAE,CAAC;YAC7B,IAAI,CAAC,kBAAkB,CAAC,MAAM,EAAE,CAAC;YACjC,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC;YAC/B,IAAI,CAAC,uBAAuB,GAAG,IAAI,CAAC;QACrC,CAAC;IACF,CAAC;IAEM,KAAK,CAAC,YAAY,CAAC,KAAK,GAAG,KAAK;QACtC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC;YAC9B,IAAI,CAAC,WAAW,EAAE,CAAC;YACnB,OAAO;QACR,CAAC;QAED,MAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;QAC5C,IAAI,CAAC,IAAI,CAAC,QAAQ,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YACzE,0BAA0B;YAC1B,IAAI,CAAC,WAAW,EAAE,CAAC;YACnB,OAAO;QACR,CAAC;QAED,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;QACtC,MAAM,cAAc,GAAG,KAAK,CAAC,YAAY,EAAE,CAAC;QAC5C,IAAI,IAAI,CAAC,uBAAuB,IAAI,IAAI,CAAC,2BAA2B,KAAK,cAAc,EAAE,CAAC;YACzF,IAAI,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,uBAAuB,CAAC,EAAE,CAAC;gBACnD,OAAO,CAAC,gBAAgB;YACzB,CAAC;YACD,IAAI,IAAI,CAAC,mBAAmB,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;gBACzC,MAAM,KAAK,GAAG,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;gBACnD,IAAI,KAAK,IAAI,KAAK,CAAC,gBAAgB,CAAC,QAAQ,CAAC,EAAE,CAAC;oBAC/C,OAAO,CAAC,gDAAgD;gBACzD,CAAC;YACF,CAAC;QACF,CAAC;QAED,IAAI,CAAC,IAAI,CAAC,uBAAuB,EAAE,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC;YACrD,kEAAkE;YAClE,MAAM,YAAY,GAAG,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;YAC1D,wGAAwG;YACxG,IAAI,CAAC,YAAY,EAAE,gBAAgB,CAAC,QAAQ,CAAC,EAAE,CAAC;gBAC/C,uDAAuD;gBACvD,IAAI,CAAC,WAAW,EAAE,CAAC;YACpB,CAAC;QACF,CAAC;QAED,IAAI,CAAC,uBAAuB,GAAG,QAAQ,CAAC;QACxC,IAAI,CAAC,2BAA2B,GAAG,cAAc,CAAC;QAElD,MAAM,iBAAiB,GAAG,IAAI,CAAC,kBAAkB,GAAG,IAAI,uBAAuB,EAAE,CAAC;QAClF,IAAI,CAAC;YACJ,MAAM,EAAE,GAAG,IAAI,SAAS,CAAC,KAAK,CAAC,CAAC;YAChC,MAAM,QAAQ,GAAG,MAAM,sBAAsB,CAAC,IAAI,CAAC,UAAU,EAAE,KAAK,EAAE,QAAQ,EAAE,iBAAiB,CAAC,KAAK,CAAC,CAAC;YACzG,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC,KAAK,EAAE,EAAE,CAAC,OAAO,EAAE,CAAC,CAAC;YACtD,IAAI,iBAAiB,KAAK,IAAI,CAAC,kBAAkB,EAAE,CAAC;gBACnD,OAAO;YACR,CAAC;YACD,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC;YAC/B,IAAI,cAAc,KAAK,KAAK,CAAC,YAAY,EAAE,EAAE,CAAC;gBAC7C,OAAO;YACR,CAAC;YAED,IAAI,MAAM,GAAa,EAAE,CAAC;YAC1B,IAAI,QAAQ,EAAE,MAAM,EAAE,CAAC;gBACtB,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC;YAC1B,CAAC;YAED,IAAI,CAAC,mBAAmB,GAAG,QAAQ,EAAE,WAAW,IAAI,IAAI,CAAC,oBAAoB,CAAC;YAE9E,IAAI,mBAAmB,GAAG,KAAK,CAAC;YAChC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC;gBACnD,IAAI,KAAK,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,EAAE,CAAC;oBACjD,mBAAmB,GAAG,IAAI,CAAC;oBAC3B,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;wBACb,MAAM,cAAc,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;wBACjC,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;wBACpB,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC;oBAChC,CAAC;oBACD,MAAM;gBACP,CAAC;YACF,CAAC;YAED,IAAI,CAAC,mBAAmB,EAAE,CAAC;gBAC1B,wEAAwE;gBACxE,IAAI,CAAC,WAAW,EAAE,CAAC;gBACnB,OAAO;YACR,CAAC;YAED,MAAM,WAAW,GAA4B,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,OAAO,EAAE,2BAAyB,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC;YACpI,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YAClC,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;YAC1C,IAAI,CAAC,gBAAgB,EAAE,CAAC,CAAC,qCAAqC;QAC/D,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACd,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,EAAE,CAAC;gBAC/B,iBAAiB,CAAC,GAAG,CAAC,CAAC;YACxB,CAAC;YACD,IAAI,IAAI,CAAC,kBAAkB,KAAK,iBAAiB,IAAI,CAAC,IAAI,CAAC,kBAAkB,EAAE,CAAC;gBAC/E,0CAA0C;gBAC1C,IAAI,CAAC,WAAW,EAAE,CAAC;YACpB,CAAC;QACF,CAAC;IAEF,CAAC;;AA9TW,yBAAyB;IAyCnC,WAAA,kBAAkB,CAAA;IAClB,WAAA,wBAAwB,CAAA;IACxB,WAAA,6BAA6B,CAAA;IAC7B,WAAA,+BAA+B,CAAA;GA5CrB,yBAAyB,CAoVrC;;AAED,MAAM,OAAO,mBAAoB,SAAQ,YAAY;IACpD;QACC,KAAK,CAAC;YACL,EAAE,EAAE,6BAA6B;YACjC,KAAK,EAAE,GAAG,CAAC,SAAS,CAAC,IAAqB,EAAE,sBAAsB,CAAC;YACnE,YAAY,EAAE,cAAc,CAAC,GAAG,CAAC,iBAAiB,CAAC,QAAQ,EAAE,iBAAiB,CAAC,iBAAiB,CAAC;YACjG,MAAM,EAAE;gBACP,MAAM,EAAE,iBAAiB,CAAC,eAAe;gBACzC,OAAO,EAAE,mDAA6B,sBAAa;gBACnD,MAAM,0CAAgC;aACtC;SACD,CAAC,CAAC;IACJ,CAAC;IAEQ,UAAU,CAAC,QAA0B,EAAE,IAAsB;QACrE,MAAM,aAAa,GAAG,QAAQ,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;QACvD,MAAM,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;QAEzE,IAAI,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,QAAQ,CAAC,WAAW,CAAC,GAAG,CAAC,EAAE,CAAC;YACjD,OAAO,aAAa,CAAC,cAAc,CAAC,EAAE,QAAQ,EAAE,GAAG,EAAE,EAAE,aAAa,CAAC,mBAAmB,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;gBACzG,IAAI,CAAC,MAAM,EAAE,CAAC;oBACb,OAAO;gBACR,CAAC;gBACD,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;gBACxB,MAAM,CAAC,mBAAmB,CAAC,QAAQ,CAAC,EAAE;oBACrC,IAAI,CAAC,eAAe,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;oBACvC,OAAO,IAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;gBACnC,CAAC,CAAC,CAAC;YACJ,CAAC,EAAE,iBAAiB,CAAC,CAAC;QACvB,CAAC;QAED,OAAO,KAAK,CAAC,UAAU,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;IACzC,CAAC;IAED,GAAG,CAAC,SAA2B,EAAE,MAAmB;QACnD,MAAM,UAAU,GAAG,yBAAyB,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QACzD,IAAI,UAAU,EAAE,CAAC;YAChB,OAAO,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC;QACvD,CAAC;QACD,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;IAC1B,CAAC;CACD;AAED,MAAM,oBAAoB,GAAG,aAAa,CAAC,kBAAkB,CAA4B,yBAAyB,CAAC,GAAG,CAAC,CAAC;AACxH,qBAAqB,CAAC,IAAI,oBAAoB,CAAC;IAC9C,EAAE,EAAE,0BAA0B;IAC9B,YAAY,EAAE,mCAAmC;IACjD,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,WAAW,EAAE;IAC7B,MAAM,EAAE;QACP,MAAM,EAAE,iBAAiB,CAAC,eAAe;QACzC,MAAM,EAAE,2CAAiC,EAAE;QAC3C,OAAO,wBAAgB;QACvB,SAAS,EAAE,CAAC,gDAA6B,CAAC;KAC1C;CACD,CAAC,CAAC,CAAC;AAGJ,SAAS,sBAAsB,CAAC,SAA8D,EAAE,KAAiB,EAAE,QAAkB,EAAE,KAAwB;IAC9J,MAAM,cAAc,GAAG,SAAS,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;IAEhD,0DAA0D;IAC1D,4CAA4C;IAC5C,oBAAoB;IACpB,OAAO,KAAK,CAAyC,cAAc,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE,CAAC,KAAK,IAAI,EAAE;QAC9F,IAAI,CAAC;YACJ,OAAO,MAAM,QAAQ,CAAC,0BAA0B,CAAC,KAAK,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;QAC1E,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACZ,yBAAyB,CAAC,CAAC,CAAC,CAAC;YAC7B,OAAO,SAAS,CAAC;QAClB,CAAC;IACF,CAAC,CAAC,EAAE,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,IAAI,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC,CAAC;AACnE,CAAC;AAED,MAAM,CAAC,MAAM,6BAA6B,GAAG,aAAa,CAAC,gCAAgC,EAAE,EAAE,IAAI,EAAE,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,WAAW,CAAC,GAAG,CAAC,EAAE,KAAK,EAAE,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,WAAW,CAAC,GAAG,CAAC,EAAE,MAAM,EAAE,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,WAAW,CAAC,GAAG,CAAC,EAAE,OAAO,EAAE,KAAK,CAAC,KAAK,EAAE,EAAE,GAAG,CAAC,QAAQ,CAAC,IAA+B,EAAE,wDAAwD,CAAC,CAAC,CAAC;AAE7W,+BAA+B,CAAC,+BAA+B,EAAE,CAAC,SAAS,EAAE,KAAK,EAAE,QAAQ,EAAE,EAAE;IAC/F,MAAM,EAAE,0BAA0B,EAAE,GAAG,SAAS,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC;IAC/E,OAAO,sBAAsB,CAAC,0BAA0B,EAAE,KAAK,EAAE,QAAQ,EAAE,iBAAiB,CAAC,IAAI,CAAC,CAAC;AACpG,CAAC,CAAC,CAAC;AAEH,0BAA0B,CAAC,yBAAyB,CAAC,EAAE,EAAE,yBAAyB,2DAAmD,CAAC;AACtI,oBAAoB,CAAC,mBAAmB,CAAC,CAAC","file":"linkedEditing.js","sourceRoot":"file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as arrays from '../../../../base/common/arrays.js';\nimport { Delayer, first } from '../../../../base/common/async.js';\nimport { CancellationToken, CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { Color } from '../../../../base/common/color.js';\nimport { isCancellationError, onUnexpectedError, onUnexpectedExternalError } from '../../../../base/common/errors.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { KeyCode, KeyMod } from '../../../../base/common/keyCodes.js';\nimport { Disposable, DisposableStore } from '../../../../base/common/lifecycle.js';\nimport * as strings from '../../../../base/common/strings.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ICodeEditor } from '../../../browser/editorBrowser.js';\nimport { EditorAction, EditorCommand, EditorContributionInstantiation, registerEditorAction, registerEditorCommand, registerEditorContribution, registerModelAndPositionCommand, ServicesAccessor } from '../../../browser/editorExtensions.js';\nimport { ICodeEditorService } from '../../../browser/services/codeEditorService.js';\nimport { EditorOption } from '../../../common/config/editorOptions.js';\nimport { IPosition, Position } from '../../../common/core/position.js';\nimport { IRange, Range } from '../../../common/core/range.js';\nimport { IEditorContribution, IEditorDecorationsCollection } from '../../../common/editorCommon.js';\nimport { EditorContextKeys } from '../../../common/editorContextKeys.js';\nimport { IModelDeltaDecoration, ITextModel, TrackedRangeStickiness } from '../../../common/model.js';\nimport { ModelDecorationOptions } from '../../../common/model/textModel.js';\nimport { LinkedEditingRangeProvider, LinkedEditingRanges } from '../../../common/languages.js';\nimport { ILanguageConfigurationService } from '../../../common/languages/languageConfigurationRegistry.js';\nimport * as nls from '../../../../nls.js';\nimport { ContextKeyExpr, IContextKey, IContextKeyService, RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { KeybindingWeight } from '../../../../platform/keybinding/common/keybindingsRegistry.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nimport { registerColor } from '../../../../platform/theme/common/colorRegistry.js';\nimport { LanguageFeatureRegistry } from '../../../common/languageFeatureRegistry.js';\nimport { ISingleEditOperation } from '../../../common/core/editOperation.js';\nimport { IFeatureDebounceInformation, ILanguageFeatureDebounceService } from '../../../common/services/languageFeatureDebounce.js';\nimport { StopWatch } from '../../../../base/common/stopwatch.js';\nimport './linkedEditing.css';\n\nexport const CONTEXT_ONTYPE_RENAME_INPUT_VISIBLE = new RawContextKey<boolean>('LinkedEditingInputVisible', false);\n\nconst DECORATION_CLASS_NAME = 'linked-editing-decoration';\n\nexport class LinkedEditingContribution extends Disposable implements IEditorContribution {\n\n\tpublic static readonly ID = 'editor.contrib.linkedEditing';\n\n\tprivate static readonly DECORATION = ModelDecorationOptions.register({\n\t\tdescription: 'linked-editing',\n\t\tstickiness: TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges,\n\t\tclassName: DECORATION_CLASS_NAME\n\t});\n\n\tstatic get(editor: ICodeEditor): LinkedEditingContribution | null {\n\t\treturn editor.getContribution<LinkedEditingContribution>(LinkedEditingContribution.ID);\n\t}\n\n\tprivate _debounceDuration: number | undefined;\n\n\tprivate readonly _editor: ICodeEditor;\n\tprivate readonly _providers: LanguageFeatureRegistry<LinkedEditingRangeProvider>;\n\tprivate _enabled: boolean;\n\n\tprivate readonly _visibleContextKey: IContextKey<boolean>;\n\tprivate readonly _debounceInformation: IFeatureDebounceInformation;\n\n\tprivate _rangeUpdateTriggerPromise: Promise<any> | null;\n\tprivate _rangeSyncTriggerPromise: Promise<any> | null;\n\n\tprivate _currentRequestCts: CancellationTokenSource | null;\n\tprivate _currentRequestPosition: Position | null;\n\tprivate _currentRequestModelVersion: number | null;\n\n\tprivate _currentDecorations: IEditorDecorationsCollection; // The one at index 0 is the reference one\n\tprivate _syncRangesToken: number = 0;\n\n\tprivate _languageWordPattern: RegExp | null;\n\tprivate _currentWordPattern: RegExp | null;\n\tprivate _ignoreChangeEvent: boolean;\n\n\tprivate readonly _localToDispose = this._register(new DisposableStore());\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@ILanguageFeaturesService languageFeaturesService: ILanguageFeaturesService,\n\t\t@ILanguageConfigurationService private readonly languageConfigurationService: ILanguageConfigurationService,\n\t\t@ILanguageFeatureDebounceService languageFeatureDebounceService: ILanguageFeatureDebounceService\n\t) {\n\t\tsuper();\n\t\tthis._editor = editor;\n\t\tthis._providers = languageFeaturesService.linkedEditingRangeProvider;\n\t\tthis._enabled = false;\n\t\tthis._visibleContextKey = CONTEXT_ONTYPE_RENAME_INPUT_VISIBLE.bindTo(contextKeyService);\n\t\tthis._debounceInformation = languageFeatureDebounceService.for(this._providers, 'Linked Editing', { max: 200 });\n\n\t\tthis._currentDecorations = this._editor.createDecorationsCollection();\n\t\tthis._languageWordPattern = null;\n\t\tthis._currentWordPattern = null;\n\t\tthis._ignoreChangeEvent = false;\n\t\tthis._localToDispose = this._register(new DisposableStore());\n\n\t\tthis._rangeUpdateTriggerPromise = null;\n\t\tthis._rangeSyncTriggerPromise = null;\n\n\t\tthis._currentRequestCts = null;\n\t\tthis._currentRequestPosition = null;\n\t\tthis._currentRequestModelVersion = null;\n\n\t\tthis._register(this._editor.onDidChangeModel(() => this.reinitialize(true)));\n\n\t\tthis._register(this._editor.onDidChangeConfiguration(e => {\n\t\t\tif (e.hasChanged(EditorOption.linkedEditing) || e.hasChanged(EditorOption.renameOnType)) {\n\t\t\t\tthis.reinitialize(false);\n\t\t\t}\n\t\t}));\n\t\tthis._register(this._providers.onDidChange(() => this.reinitialize(false)));\n\t\tthis._register(this._editor.onDidChangeModelLanguage(() => this.reinitialize(true)));\n\n\t\tthis.reinitialize(true);\n\t}\n\n\tprivate reinitialize(forceRefresh: boolean) {\n\t\tconst model = this._editor.getModel();\n\t\tconst isEnabled = model !== null && (this._editor.getOption(EditorOption.linkedEditing) || this._editor.getOption(EditorOption.renameOnType)) && this._providers.has(model);\n\t\tif (isEnabled === this._enabled && !forceRefresh) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._enabled = isEnabled;\n\n\t\tthis.clearRanges();\n\t\tthis._localToDispose.clear();\n\n\t\tif (!isEnabled || model === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._localToDispose.add(\n\t\t\tEvent.runAndSubscribe(\n\t\t\t\tmodel.onDidChangeLanguageConfiguration,\n\t\t\t\t() => {\n\t\t\t\t\tthis._languageWordPattern = this.languageConfigurationService.getLanguageConfiguration(model.getLanguageId()).getWordDefinition();\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\n\t\tconst rangeUpdateScheduler = new Delayer(this._debounceInformation.get(model));\n\t\tconst triggerRangeUpdate = () => {\n\t\t\tthis._rangeUpdateTriggerPromise = rangeUpdateScheduler.trigger(() => this.updateRanges(), this._debounceDuration ?? this._debounceInformation.get(model));\n\t\t};\n\t\tconst rangeSyncScheduler = new Delayer(0);\n\t\tconst triggerRangeSync = (token: number) => {\n\t\t\tthis._rangeSyncTriggerPromise = rangeSyncScheduler.trigger(() => this._syncRanges(token));\n\t\t};\n\t\tthis._localToDispose.add(this._editor.onDidChangeCursorPosition(() => {\n\t\t\ttriggerRangeUpdate();\n\t\t}));\n\t\tthis._localToDispose.add(this._editor.onDidChangeModelContent((e) => {\n\t\t\tif (!this._ignoreChangeEvent) {\n\t\t\t\tif (this._currentDecorations.length > 0) {\n\t\t\t\t\tconst referenceRange = this._currentDecorations.getRange(0);\n\t\t\t\t\tif (referenceRange && e.changes.every(c => referenceRange.intersectRanges(c.range))) {\n\t\t\t\t\t\ttriggerRangeSync(this._syncRangesToken);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\ttriggerRangeUpdate();\n\t\t}));\n\t\tthis._localToDispose.add({\n\t\t\tdispose: () => {\n\t\t\t\trangeUpdateScheduler.dispose();\n\t\t\t\trangeSyncScheduler.dispose();\n\t\t\t}\n\t\t});\n\t\tthis.updateRanges();\n\t}\n\n\tprivate _syncRanges(token: number): void {\n\t\t// delayed invocation, make sure we're still on\n\t\tif (!this._editor.hasModel() || token !== this._syncRangesToken || this._currentDecorations.length === 0) {\n\t\t\t// nothing to do\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = this._editor.getModel();\n\t\tconst referenceRange = this._currentDecorations.getRange(0);\n\n\t\tif (!referenceRange || referenceRange.startLineNumber !== referenceRange.endLineNumber) {\n\t\t\treturn this.clearRanges();\n\t\t}\n\n\t\tconst referenceValue = model.getValueInRange(referenceRange);\n\t\tif (this._currentWordPattern) {\n\t\t\tconst match = referenceValue.match(this._currentWordPattern);\n\t\t\tconst matchLength = match ? match[0].length : 0;\n\t\t\tif (matchLength !== referenceValue.length) {\n\t\t\t\treturn this.clearRanges();\n\t\t\t}\n\t\t}\n\n\t\tconst edits: ISingleEditOperation[] = [];\n\t\tfor (let i = 1, len = this._currentDecorations.length; i < len; i++) {\n\t\t\tconst mirrorRange = this._currentDecorations.getRange(i);\n\t\t\tif (!mirrorRange) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (mirrorRange.startLineNumber !== mirrorRange.endLineNumber) {\n\t\t\t\tedits.push({\n\t\t\t\t\trange: mirrorRange,\n\t\t\t\t\ttext: referenceValue\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tlet oldValue = model.getValueInRange(mirrorRange);\n\t\t\t\tlet newValue = referenceValue;\n\t\t\t\tlet rangeStartColumn = mirrorRange.startColumn;\n\t\t\t\tlet rangeEndColumn = mirrorRange.endColumn;\n\n\t\t\t\tconst commonPrefixLength = strings.commonPrefixLength(oldValue, newValue);\n\t\t\t\trangeStartColumn += commonPrefixLength;\n\t\t\t\toldValue = oldValue.substr(commonPrefixLength);\n\t\t\t\tnewValue = newValue.substr(commonPrefixLength);\n\n\t\t\t\tconst commonSuffixLength = strings.commonSuffixLength(oldValue, newValue);\n\t\t\t\trangeEndColumn -= commonSuffixLength;\n\t\t\t\toldValue = oldValue.substr(0, oldValue.length - commonSuffixLength);\n\t\t\t\tnewValue = newValue.substr(0, newValue.length - commonSuffixLength);\n\n\t\t\t\tif (rangeStartColumn !== rangeEndColumn || newValue.length !== 0) {\n\t\t\t\t\tedits.push({\n\t\t\t\t\t\trange: new Range(mirrorRange.startLineNumber, rangeStartColumn, mirrorRange.endLineNumber, rangeEndColumn),\n\t\t\t\t\t\ttext: newValue\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (edits.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tthis._editor.popUndoStop();\n\t\t\tthis._ignoreChangeEvent = true;\n\t\t\tconst prevEditOperationType = this._editor._getViewModel().getPrevEditOperationType();\n\t\t\tthis._editor.executeEdits('linkedEditing', edits);\n\t\t\tthis._editor._getViewModel().setPrevEditOperationType(prevEditOperationType);\n\t\t} finally {\n\t\t\tthis._ignoreChangeEvent = false;\n\t\t}\n\t}\n\n\tpublic override dispose(): void {\n\t\tthis.clearRanges();\n\t\tsuper.dispose();\n\t}\n\n\tpublic clearRanges(): void {\n\t\tthis._visibleContextKey.set(false);\n\t\tthis._currentDecorations.clear();\n\t\tif (this._currentRequestCts) {\n\t\t\tthis._currentRequestCts.cancel();\n\t\t\tthis._currentRequestCts = null;\n\t\t\tthis._currentRequestPosition = null;\n\t\t}\n\t}\n\n\tpublic async updateRanges(force = false): Promise<void> {\n\t\tif (!this._editor.hasModel()) {\n\t\t\tthis.clearRanges();\n\t\t\treturn;\n\t\t}\n\n\t\tconst position = this._editor.getPosition();\n\t\tif (!this._enabled && !force || this._editor.getSelections().length > 1) {\n\t\t\t// disabled or multicursor\n\t\t\tthis.clearRanges();\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = this._editor.getModel();\n\t\tconst modelVersionId = model.getVersionId();\n\t\tif (this._currentRequestPosition && this._currentRequestModelVersion === modelVersionId) {\n\t\t\tif (position.equals(this._currentRequestPosition)) {\n\t\t\t\treturn; // same position\n\t\t\t}\n\t\t\tif (this._currentDecorations.length > 0) {\n\t\t\t\tconst range = this._currentDecorations.getRange(0);\n\t\t\t\tif (range && range.containsPosition(position)) {\n\t\t\t\t\treturn; // just moving inside the existing primary range\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!this._currentRequestPosition?.equals(position)) {\n\t\t\t// Get the current range of the first decoration (reference range)\n\t\t\tconst currentRange = this._currentDecorations.getRange(0);\n\t\t\t// If there is no current range or the current range does not contain the new position, clear the ranges\n\t\t\tif (!currentRange?.containsPosition(position)) {\n\t\t\t\t// Clear existing decorations while we compute new ones\n\t\t\t\tthis.clearRanges();\n\t\t\t}\n\t\t}\n\n\t\tthis._currentRequestPosition = position;\n\t\tthis._currentRequestModelVersion = modelVersionId;\n\n\t\tconst currentRequestCts = this._currentRequestCts = new CancellationTokenSource();\n\t\ttry {\n\t\t\tconst sw = new StopWatch(false);\n\t\t\tconst response = await getLinkedEditingRanges(this._providers, model, position, currentRequestCts.token);\n\t\t\tthis._debounceInformation.update(model, sw.elapsed());\n\t\t\tif (currentRequestCts !== this._currentRequestCts) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._currentRequestCts = null;\n\t\t\tif (modelVersionId !== model.getVersionId()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet ranges: IRange[] = [];\n\t\t\tif (response?.ranges) {\n\t\t\t\tranges = response.ranges;\n\t\t\t}\n\n\t\t\tthis._currentWordPattern = response?.wordPattern || this._languageWordPattern;\n\n\t\t\tlet foundReferenceRange = false;\n\t\t\tfor (let i = 0, len = ranges.length; i < len; i++) {\n\t\t\t\tif (Range.containsPosition(ranges[i], position)) {\n\t\t\t\t\tfoundReferenceRange = true;\n\t\t\t\t\tif (i !== 0) {\n\t\t\t\t\t\tconst referenceRange = ranges[i];\n\t\t\t\t\t\tranges.splice(i, 1);\n\t\t\t\t\t\tranges.unshift(referenceRange);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!foundReferenceRange) {\n\t\t\t\t// Cannot do linked editing if the ranges are not where the cursor is...\n\t\t\t\tthis.clearRanges();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst decorations: IModelDeltaDecoration[] = ranges.map(range => ({ range: range, options: LinkedEditingContribution.DECORATION }));\n\t\t\tthis._visibleContextKey.set(true);\n\t\t\tthis._currentDecorations.set(decorations);\n\t\t\tthis._syncRangesToken++; // cancel any pending syncRanges call\n\t\t} catch (err) {\n\t\t\tif (!isCancellationError(err)) {\n\t\t\t\tonUnexpectedError(err);\n\t\t\t}\n\t\t\tif (this._currentRequestCts === currentRequestCts || !this._currentRequestCts) {\n\t\t\t\t// stop if we are still the latest request\n\t\t\t\tthis.clearRanges();\n\t\t\t}\n\t\t}\n\n\t}\n\n\t// private printDecorators(model: ITextModel) {\n\t// \treturn this._currentDecorations.map(d => {\n\t// \t\tconst range = model.getDecorationRange(d);\n\t// \t\tif (range) {\n\t// \t\t\treturn this.printRange(range);\n\t// \t\t}\n\t// \t\treturn 'invalid';\n\t// \t}).join(',');\n\t// }\n\n\t// private printChanges(changes: IModelContentChange[]) {\n\t// \treturn changes.map(c => {\n\t// \t\treturn `${this.printRange(c.range)} - ${c.text}`;\n\t// \t}\n\t// \t).join(',');\n\t// }\n\n\t// private printRange(range: IRange) {\n\t// \treturn `${range.startLineNumber},${range.startColumn}/${range.endLineNumber},${range.endColumn}`;\n\t// }\n}\n\nexport class LinkedEditingAction extends EditorAction {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.action.linkedEditing',\n\t\t\tlabel: nls.localize2('linkedEditing.label', \"Start Linked Editing\"),\n\t\t\tprecondition: ContextKeyExpr.and(EditorContextKeys.writable, EditorContextKeys.hasRenameProvider),\n\t\t\tkbOpts: {\n\t\t\t\tkbExpr: EditorContextKeys.editorTextFocus,\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.F2,\n\t\t\t\tweight: KeybindingWeight.EditorContrib\n\t\t\t}\n\t\t});\n\t}\n\n\toverride runCommand(accessor: ServicesAccessor, args: [URI, IPosition]): void | Promise<void> {\n\t\tconst editorService = accessor.get(ICodeEditorService);\n\t\tconst [uri, pos] = Array.isArray(args) && args || [undefined, undefined];\n\n\t\tif (URI.isUri(uri) && Position.isIPosition(pos)) {\n\t\t\treturn editorService.openCodeEditor({ resource: uri }, editorService.getActiveCodeEditor()).then(editor => {\n\t\t\t\tif (!editor) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\teditor.setPosition(pos);\n\t\t\t\teditor.invokeWithinContext(accessor => {\n\t\t\t\t\tthis.reportTelemetry(accessor, editor);\n\t\t\t\t\treturn this.run(accessor, editor);\n\t\t\t\t});\n\t\t\t}, onUnexpectedError);\n\t\t}\n\n\t\treturn super.runCommand(accessor, args);\n\t}\n\n\trun(_accessor: ServicesAccessor, editor: ICodeEditor): Promise<void> {\n\t\tconst controller = LinkedEditingContribution.get(editor);\n\t\tif (controller) {\n\t\t\treturn Promise.resolve(controller.updateRanges(true));\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n}\n\nconst LinkedEditingCommand = EditorCommand.bindToContribution<LinkedEditingContribution>(LinkedEditingContribution.get);\nregisterEditorCommand(new LinkedEditingCommand({\n\tid: 'cancelLinkedEditingInput',\n\tprecondition: CONTEXT_ONTYPE_RENAME_INPUT_VISIBLE,\n\thandler: x => x.clearRanges(),\n\tkbOpts: {\n\t\tkbExpr: EditorContextKeys.editorTextFocus,\n\t\tweight: KeybindingWeight.EditorContrib + 99,\n\t\tprimary: KeyCode.Escape,\n\t\tsecondary: [KeyMod.Shift | KeyCode.Escape]\n\t}\n}));\n\n\nfunction getLinkedEditingRanges(providers: LanguageFeatureRegistry<LinkedEditingRangeProvider>, model: ITextModel, position: Position, token: CancellationToken): Promise<LinkedEditingRanges | undefined | null> {\n\tconst orderedByScore = providers.ordered(model);\n\n\t// in order of score ask the linked editing range provider\n\t// until someone response with a good result\n\t// (good = not null)\n\treturn first<LinkedEditingRanges | undefined | null>(orderedByScore.map(provider => async () => {\n\t\ttry {\n\t\t\treturn await provider.provideLinkedEditingRanges(model, position, token);\n\t\t} catch (e) {\n\t\t\tonUnexpectedExternalError(e);\n\t\t\treturn undefined;\n\t\t}\n\t}), result => !!result && arrays.isNonEmptyArray(result?.ranges));\n}\n\nexport const editorLinkedEditingBackground = registerColor('editor.linkedEditingBackground', { dark: Color.fromHex('#f00').transparent(0.3), light: Color.fromHex('#f00').transparent(0.3), hcDark: Color.fromHex('#f00').transparent(0.3), hcLight: Color.white }, nls.localize('editorLinkedEditingBackground', 'Background color when the editor auto renames on type.'));\n\nregisterModelAndPositionCommand('_executeLinkedEditingProvider', (_accessor, model, position) => {\n\tconst { linkedEditingRangeProvider } = _accessor.get(ILanguageFeaturesService);\n\treturn getLinkedEditingRanges(linkedEditingRangeProvider, model, position, CancellationToken.None);\n});\n\nregisterEditorContribution(LinkedEditingContribution.ID, LinkedEditingContribution, EditorContributionInstantiation.AfterFirstRender);\nregisterEditorAction(LinkedEditingAction);\n"]}