{"version":3,"sources":["file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src/vs/editor/browser/controller/editContext/native/nativeEditContextUtils.ts","vs/editor/browser/controller/editContext/native/nativeEditContextUtils.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,qBAAqB,EAAE,gBAAgB,EAAE,aAAa,EAAE,MAAM,oCAAoC,CAAC;AAC5G,OAAO,EAAe,UAAU,EAAE,MAAM,yCAAyC,CAAC;AAClF,OAAO,EAAE,WAAW,EAAE,MAAM,2CAA2C,CAAC;AASjE,IAAM,YAAY,GAAlB,MAAM,YAAa,SAAQ,UAAU;IAI3C,YACc,WAAwB,EACpB,QAAqB,EACrB,cAAgD;QAEjE,KAAK,EAAE,CAAC;QAHS,aAAQ,GAAR,QAAQ,CAAa;QACrB,mBAAc,GAAd,cAAc,CAAkC;QAN1D,eAAU,GAAY,KAAK,CAAC;QAC5B,cAAS,GAAY,KAAK,CAAC;QAQlC,IAAI,CAAC,SAAS,CAAC,qBAAqB,CAAC,IAAI,CAAC,QAAQ,EAAE,OAAO,EAAE,GAAG,EAAE;YACjE,WAAW,CAAC,KAAK,CAAC,yBAAyB,CAAC,CAAC;YAC7C,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;gBACpB,OAAO;YACR,CAAC;YACD,uDAAuD;YACvD,qDAAqD;YACrD,qDAAqD;YACrD,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAC1B,CAAC,CAAC,CAAC,CAAC;QACJ,IAAI,CAAC,SAAS,CAAC,qBAAqB,CAAC,IAAI,CAAC,QAAQ,EAAE,MAAM,EAAE,GAAG,EAAE;YAChE,WAAW,CAAC,KAAK,CAAC,wBAAwB,CAAC,CAAC;YAC5C,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;gBACpB,OAAO;YACR,CAAC;YACD,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC,CAAC;QACnC,CAAC,CAAC,CAAC,CAAC;IACL,CAAC;IAEM,KAAK;QACX,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;IACvB,CAAC;IAEM,MAAM;QACZ,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;QACvB,IAAI,CAAC,iBAAiB,EAAE,CAAC;IAC1B,CAAC;IAEO,qBAAqB,CAAC,OAAgB;QAC7C,IAAI,IAAI,CAAC,UAAU,KAAK,OAAO,EAAE,CAAC;YACjC,OAAO;QACR,CAAC;QACD,IAAI,CAAC,UAAU,GAAG,OAAO,CAAC;QAC1B,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IACtC,CAAC;IAEM,KAAK;QACX,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC;QACtB,IAAI,CAAC,iBAAiB,EAAE,CAAC;IAC1B,CAAC;IAEM,iBAAiB;QACvB,MAAM,UAAU,GAAG,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAChD,MAAM,aAAa,GAAG,UAAU,CAAC,CAAC,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC,gBAAgB,EAAE,CAAC;QACjF,MAAM,OAAO,GAAG,IAAI,CAAC,QAAQ,KAAK,aAAa,CAAC;QAChD,IAAI,CAAC,qBAAqB,CAAC,OAAO,CAAC,CAAC;IACrC,CAAC;IAED,IAAI,SAAS;QACZ,OAAO,IAAI,CAAC,UAAU,CAAC;IACxB,CAAC;CACD,CAAA;AA7DY,YAAY;IAKtB,WAAA,WAAW,CAAA;GALD,YAAY,CA6DxB;;AAED,MAAM,UAAU,gCAAgC,CAAmD,MAAmB,EAAE,IAAO,EAAE,QAAqF,EAAE,OAA2C;IAClQ,MAAM,CAAC,gBAAgB,CAAC,IAAI,EAAE,QAAe,EAAE,OAAO,CAAC,CAAC;IACxD,OAAO;QACN,OAAO;YACN,MAAM,CAAC,mBAAmB,CAAC,IAAI,EAAE,QAAe,CAAC,CAAC;QACnD,CAAC;KACD,CAAC;AACH,CAAC","file":"nativeEditContextUtils.js","sourceRoot":"file:///mnt/vss/_work/1/s/dependencies/vscode/out-editor-src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { addDisposableListener, getActiveElement, getShadowRoot } from '../../../../../base/browser/dom.js';\nimport { IDisposable, Disposable } from '../../../../../base/common/lifecycle.js';\nimport { ILogService } from '../../../../../platform/log/common/log.js';\n\nexport interface ITypeData {\n\ttext: string;\n\treplacePrevCharCnt: number;\n\treplaceNextCharCnt: number;\n\tpositionDelta: number;\n}\n\nexport class FocusTracker extends Disposable {\n\tprivate _isFocused: boolean = false;\n\tprivate _isPaused: boolean = false;\n\n\tconstructor(\n\t\t@ILogService _logService: ILogService,\n\t\tprivate readonly _domNode: HTMLElement,\n\t\tprivate readonly _onFocusChange: (newFocusValue: boolean) => void,\n\t) {\n\t\tsuper();\n\t\tthis._register(addDisposableListener(this._domNode, 'focus', () => {\n\t\t\t_logService.trace('NativeEditContext.focus');\n\t\t\tif (this._isPaused) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Here we don't trust the browser and instead we check\n\t\t\t// that the active element is the one we are tracking\n\t\t\t// (this happens when cmd+tab is used to switch apps)\n\t\t\tthis.refreshFocusState();\n\t\t}));\n\t\tthis._register(addDisposableListener(this._domNode, 'blur', () => {\n\t\t\t_logService.trace('NativeEditContext.blur');\n\t\t\tif (this._isPaused) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._handleFocusedChanged(false);\n\t\t}));\n\t}\n\n\tpublic pause(): void {\n\t\tthis._isPaused = true;\n\t}\n\n\tpublic resume(): void {\n\t\tthis._isPaused = false;\n\t\tthis.refreshFocusState();\n\t}\n\n\tprivate _handleFocusedChanged(focused: boolean): void {\n\t\tif (this._isFocused === focused) {\n\t\t\treturn;\n\t\t}\n\t\tthis._isFocused = focused;\n\t\tthis._onFocusChange(this._isFocused);\n\t}\n\n\tpublic focus(): void {\n\t\tthis._domNode.focus();\n\t\tthis.refreshFocusState();\n\t}\n\n\tpublic refreshFocusState(): void {\n\t\tconst shadowRoot = getShadowRoot(this._domNode);\n\t\tconst activeElement = shadowRoot ? shadowRoot.activeElement : getActiveElement();\n\t\tconst focused = this._domNode === activeElement;\n\t\tthis._handleFocusedChanged(focused);\n\t}\n\n\tget isFocused(): boolean {\n\t\treturn this._isFocused;\n\t}\n}\n\nexport function editContextAddDisposableListener<K extends keyof EditContextEventHandlersEventMap>(target: EventTarget, type: K, listener: (this: GlobalEventHandlers, ev: EditContextEventHandlersEventMap[K]) => any, options?: boolean | AddEventListenerOptions): IDisposable {\n\ttarget.addEventListener(type, listener as any, options);\n\treturn {\n\t\tdispose() {\n\t\t\ttarget.removeEventListener(type, listener as any);\n\t\t}\n\t};\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { addDisposableListener, getActiveElement, getShadowRoot } from '../../../../../base/browser/dom.js';\nimport { IDisposable, Disposable } from '../../../../../base/common/lifecycle.js';\nimport { ILogService } from '../../../../../platform/log/common/log.js';\n\nexport interface ITypeData {\n\ttext: string;\n\treplacePrevCharCnt: number;\n\treplaceNextCharCnt: number;\n\tpositionDelta: number;\n}\n\nexport class FocusTracker extends Disposable {\n\tprivate _isFocused: boolean = false;\n\tprivate _isPaused: boolean = false;\n\n\tconstructor(\n\t\t@ILogService _logService: ILogService,\n\t\tprivate readonly _domNode: HTMLElement,\n\t\tprivate readonly _onFocusChange: (newFocusValue: boolean) => void,\n\t) {\n\t\tsuper();\n\t\tthis._register(addDisposableListener(this._domNode, 'focus', () => {\n\t\t\t_logService.trace('NativeEditContext.focus');\n\t\t\tif (this._isPaused) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Here we don't trust the browser and instead we check\n\t\t\t// that the active element is the one we are tracking\n\t\t\t// (this happens when cmd+tab is used to switch apps)\n\t\t\tthis.refreshFocusState();\n\t\t}));\n\t\tthis._register(addDisposableListener(this._domNode, 'blur', () => {\n\t\t\t_logService.trace('NativeEditContext.blur');\n\t\t\tif (this._isPaused) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._handleFocusedChanged(false);\n\t\t}));\n\t}\n\n\tpublic pause(): void {\n\t\tthis._isPaused = true;\n\t}\n\n\tpublic resume(): void {\n\t\tthis._isPaused = false;\n\t\tthis.refreshFocusState();\n\t}\n\n\tprivate _handleFocusedChanged(focused: boolean): void {\n\t\tif (this._isFocused === focused) {\n\t\t\treturn;\n\t\t}\n\t\tthis._isFocused = focused;\n\t\tthis._onFocusChange(this._isFocused);\n\t}\n\n\tpublic focus(): void {\n\t\tthis._domNode.focus();\n\t\tthis.refreshFocusState();\n\t}\n\n\tpublic refreshFocusState(): void {\n\t\tconst shadowRoot = getShadowRoot(this._domNode);\n\t\tconst activeElement = shadowRoot ? shadowRoot.activeElement : getActiveElement();\n\t\tconst focused = this._domNode === activeElement;\n\t\tthis._handleFocusedChanged(focused);\n\t}\n\n\tget isFocused(): boolean {\n\t\treturn this._isFocused;\n\t}\n}\n\nexport function editContextAddDisposableListener<K extends keyof EditContextEventHandlersEventMap>(target: EventTarget, type: K, listener: (this: GlobalEventHandlers, ev: EditContextEventHandlersEventMap[K]) => any, options?: boolean | AddEventListenerOptions): IDisposable {\n\ttarget.addEventListener(type, listener as any, options);\n\treturn {\n\t\tdispose() {\n\t\t\ttarget.removeEventListener(type, listener as any);\n\t\t}\n\t};\n}\n"]}