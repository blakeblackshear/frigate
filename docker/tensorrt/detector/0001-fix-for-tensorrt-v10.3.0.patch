From 21eb9bbcd35fd9eed8b5365ed7b43853486fd8a0 Mon Sep 17 00:00:00 2001
From: Lander Noterman <lander.noterman@basalte.be>
Date: Thu, 13 Feb 2025 13:52:19 +0100
Subject: [PATCH] fix for tensorrt v10.3.0

---
 plugins/Makefile         | 2 +-
 yolo/onnx_to_tensorrt.py | 9 +++++----
 2 files changed, 6 insertions(+), 5 deletions(-)

diff --git a/plugins/Makefile b/plugins/Makefile
index 51af1cd..d7cea4c 100644
--- a/plugins/Makefile
+++ b/plugins/Makefile
@@ -21,7 +21,7 @@ TENSORRT_LIBS=-L"/usr/local/TensorRT-7.1.3.4/lib"

 # INCS and LIBS
 INCS=-I"/usr/local/cuda/include" $(TENSORRT_INCS) -I"/usr/local/include" -I"plugin"
-LIBS=-L"/usr/local/cuda/lib64" $(TENSORRT_LIBS) -L"/usr/local/lib" -Wl,--start-group -lnvinfer -lnvparsers -lnvinfer_plugin -lcudnn -lcublas -lnvToolsExt -lcudart -lrt -ldl -lpthread -Wl,--end-group
+LIBS=-L"/usr/local/cuda/lib64" $(TENSORRT_LIBS) -L"/usr/local/lib" -Wl,--start-group -lnvinfer -lnvinfer_plugin -lcudnn -lcublas -lnvToolsExt -lcudart -lrt -ldl -lpthread -Wl,--end-group

 .PHONY: all clean

diff --git a/yolo/onnx_to_tensorrt.py b/yolo/onnx_to_tensorrt.py
index 77862db..06d0759 100644
--- a/yolo/onnx_to_tensorrt.py
+++ b/yolo/onnx_to_tensorrt.py
@@ -194,7 +193,9 @@ def build_engine(model_name, do_int8, dla_core, verbose=False):
             if dla_core >= 0:
                 config.default_device_type = trt.DeviceType.DLA
                 config.DLA_core = dla_core
-                config.set_flag(trt.BuilderFlag.STRICT_TYPES)
+                config.set_flag(trt.BuilderFlag.PREFER_PRECISION_CONSTRAINTS)
+                config.set_flag(trt.BuilderFlag.DIRECT_IO)
+                config.set_flag(trt.BuilderFlag.REJECT_EMPTY_ALGORITHMS)
                 print('Using DLA core %d.' % dla_core)
             engine = builder.build_serialized_network(network, config)

--
2.48.1
